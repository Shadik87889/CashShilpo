<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Subscription - CashShilpo</title>

    <!-- Favicon -->
    <link
      rel="shortcut icon"
      href="cashshilpo-official-fav.png"
      type="image/x-icon"
    />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,500;1,400;1,500&display=swap"
      rel="stylesheet"
    />

    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@0.452.0/dist/umd/lucide.js"></script>

    <style>
      /* --- Root Variables --- */
      :root {
        --accent-color: #39ff14; /* Vibrant lime green */
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: #000;
        color: #fff;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .font-testimonial {
        font-family: "Cormorant Garamond", serif;
      }
      .text-accent {
        color: var(--accent-color);
      }
      .bg-accent {
        background-color: var(--accent-color);
      }
      .border-accent {
        border-color: var(--accent-color);
      }
      .ring-accent {
        --tw-ring-color: var(--accent-color);
      }
      .shadow-accent-2xl {
        box-shadow: 0 0px 40px -12px rgba(57, 255, 20, 0.4);
      }

      html {
        scroll-padding-top: 100px;
      }

      /* --- Nav Link Hover Effect --- */
      .nav-link {
        position: relative;
        padding-bottom: 8px;
        overflow: hidden;
        transition: color 0.3s ease;
        color: #d1d5db; /* text-gray-300 */
      }
      .nav-link:hover {
        color: var(--accent-color);
      }
      .nav-link::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 0%;
        height: 2px;
        background-color: var(--accent-color);
        transition: width 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }
      .nav-link:hover::after {
        width: 100%;
      }

      /* --- Scroll Animation System --- */
      .animate-fade-in-up,
      .animate-scale-in,
      .animate-card {
        opacity: 0;
        transition: opacity 0.7s ease-out, transform 0.7s ease-out;
      }
      .animate-fade-in-up {
        transform: translateY(40px);
      }
      .animate-scale-in {
        transform: scale(0.95);
      }
      .animate-card {
        transform: translateY(30px) scale(0.98);
      }
      .is-visible {
        opacity: 1;
        transform: translateY(0) translateX(0) scale(1);
      }
      .animate-stagger-children.is-visible .animate-card {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      .animate-stagger-children.is-visible .animate-card:nth-child(1) {
        transition-delay: 0.1s;
      }
      .animate-stagger-children.is-visible .animate-card:nth-child(2) {
        transition-delay: 0.2s;
      }
      .animate-stagger-children.is-visible .animate-card:nth-child(3) {
        transition-delay: 0.3s;
      }
      .animate-stagger-children.is-visible .animate-card:nth-child(4) {
        transition-delay: 0.4s;
      }

      /* --- Pricing Toggle Switch --- */
      .toggle-switch-container {
        position: relative;
        display: inline-flex;
        background-color: #1f2937; /* bg-gray-800 */
        border-radius: 9999px;
        padding: 4px;
        border: 1px solid #374151; /* border-gray-700 */
      }
      .toggle-switch-label {
        cursor: pointer;
        padding: 8px 20px;
        font-weight: 600;
        border-radius: 9999px;
        transition: all 0.3s ease;
        z-home: 10;
        position: relative;
        width: 120px;
        text-align: center;
      }
      .toggle-switch-label.active {
        color: #000; /* text-black */
      }
      .toggle-switch-label.inactive {
        color: #9ca3af; /* text-gray-400 */
      }
      .toggle-switch-slider {
        position: absolute;
        top: 4px;
        bottom: 4px;
        width: calc(50% - 4px);
        background-color: var(--accent-color);
        border-radius: 9999px;
        transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        transform: translateX(0);
        z-home: 5;
      }
      input[type="checkbox"]:checked + .toggle-switch-slider {
        transform: translateX(100%);
      }
      .toggle-switch-checkbox {
        display: none;
      }
      .save-badge {
        position: absolute;
        top: -24px;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--accent-color);
        color: #000;
        padding: 3px 10px;
        border-radius: 9999px;
        font-size: 11px;
        font-weight: 700;
        white-space: nowrap;
      }

      /* Custom checkmark for pricing cards */
      .check-dim {
        color: #6b7280; /* text-gray-500 */
      }
      .check-accent {
        color: var(--accent-color);
      }

      /* --- Form Input/Select styles --- */
      .form-input,
      .form-select {
        background-color: #1f2937; /* bg-gray-800 */
        border: 1px solid #374151; /* border-gray-700 */
        color: #f9fafb; /* text-white */
        border-radius: 0.5rem; /* rounded-lg */
        padding: 0.75rem 1.25rem; /* px-5 py-3 */
        width: 100%;
        transition: all 0.2s ease;
      }
      .form-input:focus,
      .form-select:focus {
        --tw-ring-opacity: 1;
        box-shadow: 0 0 0 2px var(--accent-color);
        border-color: var(--accent-color);
        outline: none;
      }

      /* --- Button styles --- */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem 1.5rem; /* px-6 py-3 */
        border-radius: 0.5rem; /* rounded-lg */
        font-weight: 700; /* font-bold */
        font-size: 1rem; /* text-base */
        transition: all 0.3s;
        transform-origin: center;
        cursor: pointer;
      }
      .btn-primary {
        background-color: var(--accent-color);
        color: #000; /* black */
      }
      .btn-primary:hover:not(:disabled) {
        background-color: #ffffff; /* white */
        transform: scale(1.05);
      }
      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .btn-secondary {
        background-color: #374151; /* bg-gray-700 */
        color: #ffffff; /* white */
      }
      .btn-secondary:hover:not(:disabled) {
        background-color: #4b5563; /* bg-gray-600 */
      }
      .btn-secondary:disabled {
        opacity: 0.5;
        background-color: #1f2937;
        color: #4b5563;
        cursor: not-allowed;
      }

      /* --- Loader animation --- */
      .loader {
        width: 24px;
        height: 24px;
        border: 3px solid #1f2937; /* bg-gray-800 */
        border-bottom-color: var(--accent-color);
        border-radius: 50%;
        display: inline-block;
        animation: rotation 1s linear infinite;
      }
      @keyframes rotation {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* --- NEW: Plan Card Badge --- */
      .plan-badge {
        position: absolute;
        top: -16px; /* Raised from -top-4 to be more visible */
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.75rem; /* text-sm */
        font-weight: 700; /* font-bold */
        text-transform: uppercase;
        padding: 0.25rem 0.75rem; /* px-3 py-1 */
        border-radius: 9999px; /* rounded-full */
      }
      .badge-current-plan {
        background-color: var(--accent-color);
        color: #000; /* black */
      }
      .badge-most-popular {
        background-color: var(--accent-color);
        color: #000;
      }
      .badge-downgrade {
        background-color: #4b5563; /* bg-gray-600 */
        color: #d1d5db; /* text-gray-300 */
      }

      /* --- NEW: Disabled Card State --- */
      .plan-card-disabled {
        opacity: 0.7;
        background-color: #111827; /* bg-gray-900 */
        border-color: #1f2937; /* border-gray-800 */
        transform: scale(0.98);
      }

      /* --- NEW: Loading Overlay --- */
      #loading-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-home: 100;
        transition: opacity 0.3s ease;
      }
      .loader-large {
        width: 48px;
        height: 48px;
        border: 4px solid #374151; /* border-gray-700 */
        border-bottom-color: var(--accent-color);
      }
    </style>
  </head>
  <body class="bg-black text-white antialiased">
    <!-- NEW: Loading Overlay -->
    <div id="loading-overlay">
      <div class="flex flex-col items-center gap-4">
        <div class="loader loader-large"></div>
        <p class="text-lg text-gray-300">
          Loading your subscription details...
        </p>
      </div>
    </div>

    <!-- Navigation -->
    <nav
      class="container mx-auto px-6 py-6 flex justify-between items-center sticky top-0 z-50 bg-black bg-opacity-80 backdrop-blur-md border-b border-gray-800"
    >
      <a
        href="home"
        class="flex items-center space-x-2 text-3xl font-extrabold text-white"
      >
        <img
          src="cashshilpo-official-logo.png"
          alt="CashShilpo Logo"
          class="w-12 h-12 object-contain"
          onerror="this.style.display='none'"
        />
        <span>Cash<span class="text-accent">Shilpo</span>.</span>
      </a>
      <div class="hidden md:flex space-x-8 items-center">
        <a href="home#features" class="nav-link">Features</a>
        <a href="home" class="nav-link">Pricing</a>
        <a href="support" class="nav-link">Support</a>
        <a
          href="workplace"
          class="bg-accent text-black font-semibold px-6 py-3 rounded-full hover:bg-white hover:scale-105 transition-all duration-300 transform"
        >
          Get Started
        </a>
      </div>
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 rounded-md text-gray-300 hover:text-white"
      >
        <i data-lucide="menu" class="h-8 w-8"></i>
      </button>
    </nav>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="hidden md:hidden bg-gray-900 p-6 fixed top-24 left-0 right-0 z-40 border-b-2 border-accent space-y-2 w-full"
    >
      <a
        href="home#features"
        class="block text-gray-300 hover:text-accent py-3 px-3 hover:bg-gray-800 rounded-md transform hover:translate-x-2 transition-all duration-300"
        >Features</a
      >
      <a
        href="home"
        class="block text-gray-300 hover:text-accent py-3 px-3 hover:bg-gray-800 rounded-md transform hover:translate-x-2 transition-all duration-300"
        >Pricing</a
      >
      <a
        href="support"
        class="block text-gray-300 hover:text-accent py-3 px-3 hover:bg-gray-800 rounded-md transform hover:translate-x-2 transition-all duration-300"
        >Support</a
      >
      <a
        href="workplace"
        class="mt-4 block bg-accent text-black font-semibold px-6 py-3 rounded-full text-center hover:bg-white hover:scale-105 transition-all duration-300 transform"
      >
        Get Started
      </a>
    </div>

    <!-- Main Content Wrapper -->
    <main
      class="flex flex-col items-center justify-center min-h-screen p-4 overflow-x-hidden"
    >
      <div id="main-container" class="w-full max-w-7xl hidden">
        <!-- Header Section -->
        <header
          class="container mx-auto px-6 pt-24 pb-32 md:pt-32 md:pb-32 text-center"
        >
          <h1
            id="main-header"
            class="text-5xl sm:text-6xl md:text-8xl font-extrabold leading-tight tracking-tighter animate-fade-in-up text-white"
          >
            MANAGE YOUR <span class="text-accent">SUBSCRIPTION.</span>
          </h1>
          <p
            id="main-subheader"
            class="text-lg md:text-xl text-gray-400 mt-8 max-w-3xl mx-auto animate-fade-in-up"
            style="transition-delay: 0.1s;"
          >
            Choose to upgrade your plan or switch to yearly billing to save.
          </p>
        </header>

        <!-- Toggle Switch -->
        <div
          class="container mx-auto px-6 flex justify-center items-center mb-16 animate-fade-in-up mt-8"
          style="transition-delay: 0.2s;"
        >
          <div class="toggle-switch-container">
            <input
              type="checkbox"
              id="price-toggle-checkbox"
              class="toggle-switch-checkbox"
            />
            <div class="toggle-switch-slider"></div>
            <label
              for="price-toggle-checkbox"
              id="label-monthly"
              class="toggle-switch-label active"
              >Monthly</label
            >
            <label
              for="price-toggle-checkbox"
              id="label-yearly"
              class="toggle-switch-label inactive"
            >
              <span class="save-badge" id="toggle-save-badge">Save 20%</span>
              Yearly
            </label>
          </div>
        </div>

        <div id="renewal-steps-container">
          <!-- Step 1: Plan Selection -->
          <div id="step-1" class="step-container container mx-auto px-6">
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 max-w-7xl mx-auto animate-stagger-children"
            >
              <!-- Card 1: Basic -->
              <div
                id="plan-card-basic"
                class="plan-card animate-card bg-gray-900 p-8 rounded-2xl border border-gray-800 flex flex-col hover:border-gray-700 transition-all duration-300 relative"
                data-monthly-price="1499"
                data-plan-base="basic"
              >
                <!-- DYNAMIC BADGE -->
                <div id="badge-basic" class="plan-badge hidden"></div>

                <h3 class="text-2xl font-bold text-white">Basic</h3>
                <p class="text-gray-400 mt-2 mb-6">
                  Perfect for new businesses and single-store owners.
                </p>
                <div class="my-4">
                  <!-- Monthly Price -->
                  <div class="price-monthly">
                    <span
                      class="text-5xl font-extrabold text-white price-monthly-value"
                    ></span>
                    <span class="text-gray-400 text-lg">/ mo</span>
                  </div>
                  <!-- Yearly Price -->
                  <div class="price-yearly hidden">
                    <span
                      class="text-2xl font-medium text-gray-500 line-through price-yearly-original"
                    ></span>
                    <span
                      class="text-5xl font-extrabold text-white price-yearly-discounted"
                    ></span>
                    <span class="text-gray-400 text-lg">/ yr</span>
                    <span
                      class="block text-sm font-semibold text-accent mt-1 price-yearly-save"
                    ></span>
                  </div>
                </div>
                <ul class="space-y-4 mt-8 text-gray-300 flex-grow">
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="store"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>1</b> Store</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="package"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>1,000</b> Products</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="users"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>5</b> Staff</span>
                  </li>

                  <!-- <li class="flex items-center space-x-3">
                    <i
                      data-lucide="x"
                      class="h-5 w-5 check-dim flex-shrink-0"
                    ></i
                    ><span>AI Assistance</span>
                  </li> -->
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="check-circle"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i>
                    <span>All other features</span>
                  </li>
                </ul>
                <!-- RENEWAL BUTTONS -->
                <button
                  type="button"
                  class="btn-renew price-monthly btn btn-primary w-full mt-8"
                  data-plan-id="basic_monthly"
                >
                  Renew Monthly
                </button>
                <button
                  type="button"
                  class="btn-renew price-yearly hidden btn btn-primary w-full mt-8"
                  data-plan-id="basic_yearly"
                >
                  Renew Yearly
                </button>
              </div>

              <!-- Card 2: Standard (Most Popular) -->
              <div
                id="plan-card-standard"
                class="plan-card animate-card relative bg-gray-900 p-8 rounded-2xl border-2 border-accent flex flex-col shadow-accent-2xl lg:scale-105"
                data-monthly-price="2999"
                data-plan-base="standard"
              >
                <!-- DYNAMIC BADGE -->
                <div id="badge-standard" class="plan-badge hidden"></div>

                <h3 class="text-2xl font-bold text-white">Standard</h3>
                <p class="text-gray-400 mt-2 mb-6">
                  For growing businesses that need advanced features.
                </p>
                <div class="my-4">
                  <!-- Monthly Price -->
                  <div class="price-monthly">
                    <span
                      class="text-5xl font-extrabold text-white price-monthly-value"
                    ></span>
                    <span class="text-gray-400 text-lg">/ mo</span>
                  </div>
                  <!-- Yearly Price -->
                  <div class="price-yearly hidden">
                    <span
                      class="text-2xl font-medium text-gray-500 line-through price-yearly-original"
                    ></span>
                    <span
                      class="text-5xl font-extrabold text-white price-yearly-discounted"
                    ></span>
                    <span class="text-gray-400 text-lg">/ yr</span>
                    <span
                      class="block text-sm font-semibold text-accent mt-1 price-yearly-save"
                    ></span>
                  </div>
                </div>
                <ul class="space-y-4 mt-8 text-gray-300 flex-grow">
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="store"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>3</b> Stores</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="package"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>10,000</b> Products</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="users"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>20</b> Staff</span>
                  </li>
                  <!-- <li class="flex items-center space-x-3">
                    <i
                      data-lucide="sparkles"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span>Basic AI Assistance</span>
                  </li> -->
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="check-circle"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i>
                    <span>All other features</span>
                  </li>
                </ul>
                <!-- RENEWAL BUTTONS -->
                <button
                  type="button"
                  class="btn-renew price-monthly btn btn-primary w-full mt-8"
                  data-plan-id="standard_monthly"
                >
                  Renew Monthly
                </button>
                <button
                  type="button"
                  class="btn-renew price-yearly hidden btn btn-primary w-full mt-8"
                  data-plan-id="standard_yearly"
                >
                  Renew Yearly
                </button>
              </div>

              <!-- Card 3: Premium -->
              <div
                id="plan-card-premium"
                class="plan-card animate-card bg-gray-900 p-8 rounded-2xl border border-gray-800 flex flex-col hover:border-gray-700 transition-all duration-300 relative"
                data-monthly-price="5999"
                data-plan-base="premium"
              >
                <!-- DYNAMIC BADGE -->
                <div id="badge-premium" class="plan-badge hidden"></div>

                <h3 class="text-2xl font-bold text-white">Premium</h3>
                <p class="text-gray-400 mt-2 mb-6">
                  For established businesses scaling up their operations.
                </p>
                <div class="my-4">
                  <!-- Monthly Price -->
                  <div class="price-monthly">
                    <span
                      class="text-5xl font-extrabold text-white price-monthly-value"
                    ></span>
                    <span class="text-gray-400 text-lg">/ mo</span>
                  </div>
                  <!-- Yearly Price -->
                  <div class="price-yearly hidden">
                    <span
                      class="text-2xl font-medium text-gray-500 line-through price-yearly-original"
                    ></span>
                    <span
                      class="text-5xl font-extrabold text-white price-yearly-discounted"
                    ></span>
                    <span class="text-gray-400 text-lg">/ yr</span>
                    <span
                      class="block text-sm font-semibold text-accent mt-1 price-yearly-save"
                    ></span>
                  </div>
                </div>
                <ul class="space-y-4 mt-8 text-gray-300 flex-grow">
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="store"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>10</b> Stores</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="package"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>50,000</b> Products</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="users"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span><b>50</b> Staff</span>
                  </li>
                  <!-- <li class="flex items-center space-x-3">
                    <i
                      data-lucide="sparkles"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span>Advanced AI Assistance</span>
                  </li> -->
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="check-circle"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i>
                    <span>All other features</span>
                  </li>
                </ul>
                <!-- RENEWAL BUTTONS -->
                <button
                  type="button"
                  class="btn-renew price-monthly btn btn-primary w-full mt-8"
                  data-plan-id="premium_monthly"
                >
                  Renew Monthly
                </button>
                <button
                  type="button"
                  class="btn-renew price-yearly hidden btn btn-primary w-full mt-8"
                  data-plan-id="premium_yearly"
                >
                  Renew Yearly
                </button>
              </div>

              <!-- Card 4: Enterprise -->
              <div
                class="animate-card bg-gray-900 p-8 rounded-2xl border border-gray-800 flex flex-col hover:border-gray-700 transition-all duration-300"
              >
                <h3 class="text-2xl font-bold text-white">Enterprise</h3>
                <p class="text-gray-400 mt-2 mb-6">
                  For large-scale operations with custom needs.
                </p>
                <div class="my-4">
                  <span class="text-5xl font-extrabold text-white"
                    >Let's Talk</span
                  >
                </div>
                <ul class="space-y-4 mt-8 text-gray-300 flex-grow">
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="check-check"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span>All Premium Features</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="link"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span>Custom Integrations</span>
                  </li>
                  <li class="flex items-center space-x-3">
                    <i
                      data-lucide="shield-alert"
                      class="h-5 w-5 check-accent flex-shrink-0"
                    ></i
                    ><span>24/7 Priority Support</span>
                  </li>
                </ul>
                <a
                  href="mailto:sales@cashshilpo.com"
                  class="w-full text-center bg-gray-800 text-white font-semibold px-6 py-3 rounded-full hover:bg-gray-700 transition-all duration-300 mt-8"
                >
                  যোগাযোগ করুন
                </a>
              </div>
            </div>
          </div>

          <!-- Step 2: Payment Instructions & Form -->
          <div
            id="step-2"
            class="step-container hidden mt-24 max-w-4xl mx-auto"
          >
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
              <!-- Instructions -->
              <div id="payment-instructions" class="space-y-6">
                <h2 class="text-2xl font-semibold">Step 2: Make Payment</h2>
                <div class="bg-gray-900 border border-gray-800 p-6 rounded-2xl">
                  <p class="text-gray-400">Please send a payment of</p>
                  <p
                    id="payment-amount"
                    class="text-5xl font-extrabold text-accent my-2"
                  ></p>
                  <p
                    id="selected-plan-name"
                    class="text-gray-400 font-medium"
                  ></p>
                </div>
                <div class="space-y-4 text-base">
                  <p class="font-semibold text-white">Payment Methods:</p>
                  <div
                    class="p-5 bg-gray-900 rounded-lg border border-gray-800 space-y-2"
                  >
                    <p>
                      <strong>bKash/Nagad/Rocket (Send Money):</strong>
                      <code class="font-mono bg-gray-800 px-2 py-1 rounded"
                        >01700000000</code
                      >
                    </p>
                    <p>
                      <strong>Bank Transfer:</strong> Bank Name, Account:
                      <code class="font-mono bg-gray-800 px-2 py-1 rounded"
                        >123456789</code
                      >, Branch: Main
                    </p>
                    <p class="!mt-4 text-yellow-400">
                      <strong>Important:</strong> Please use your User ID as the
                      reference for the payment.
                    </p>
                    <p class="text-gray-400 !mt-3">
                      Your User ID:
                      <code
                        id="user-id-display"
                        class="font-mono bg-gray-800 px-2 py-1 rounded"
                      ></code>
                    </p>
                  </div>
                </div>
              </div>

              <!-- Form -->
              <div class="space-y-6">
                <h2 class="text-2xl font-semibold">
                  Step 3: Submit Payment Proof
                </h2>
                <p class="text-base text-gray-400">
                  After making the payment, fill out this form. Your account
                  will be activated within 12 hours of verification.
                </p>
                <form
                  id="payment-proof-form"
                  class="bg-gray-900 border border-gray-800 p-6 rounded-2xl space-y-5"
                >
                  <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2"
                      >Payment Method Used</label
                    >
                    <select name="paymentMethod" class="form-select" required>
                      <option>bKash</option>
                      <option>Nagad</option>
                      <option>Rocket</option>
                      <option>Bank Transfer</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2"
                      >Transaction ID (TrxID)</label
                    >
                    <input
                      type="text"
                      name="transactionId"
                      class="form-input"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2"
                      >Your Sending Number / Account</label
                    >
                    <input
                      type="text"
                      name="senderNumber"
                      class="form-input"
                      required
                    />
                  </div>
                  <div class="flex justify-between items-center !mt-8">
                    <button
                      type="button"
                      id="back-to-plans"
                      class="btn btn-secondary"
                    >
                      <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i>
                      Back
                    </button>
                    <button
                      type="submit"
                      id="submit-proof-btn"
                      class="btn btn-primary"
                    >
                      Submit for Verification
                      <i data-lucide="arrow-right" class="w-5 h-5 ml-2"></i>
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Step 3: Confirmation -->
          <div id="step-3" class="step-container hidden text-center mt-24">
            <div
              class="bg-gray-900 border border-gray-800 p-12 rounded-2xl max-w-lg mx-auto"
            >
              <i
                data-lucide="check-circle"
                class="w-20 h-20 text-accent mx-auto mb-8"
              ></i>
              <h2 class="text-3xl font-bold text-white mb-4">
                Request Submitted!
              </h2>
              <p class="text-lg text-gray-400">
                Thank you. We have received your payment information. Your
                account will be reactivated as soon as our team verifies the
                transaction (usually within 12 hours). You may now close this
                window.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- NEW: Error container for invalid user -->
      <div
        id="error-container"
        class="w-full max-w-lg mx-auto text-center hidden"
      >
        <div
          class="bg-red-900 border border-red-700 text-red-100 p-8 rounded-2xl mt-24"
        >
          <i
            data-lucide="alert-triangle"
            class="w-16 h-16 text-red-400 mx-auto mb-6"
          ></i>
          <h2 class="text-2xl font-bold mb-4">Error: Invalid User</h2>
          <p id="error-message" class="text-red-200"></p>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800 mt-20 w-full">
      <div class="container mx-auto px-6 py-20">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-12">
          <!-- Column 1: Logo & Mission -->
          <div class="md:col-span-12 lg:col-span-5">
            <a href="home" class="text-3xl font-extrabold text-white">
              Cash<span class="text-accent">Shilpo</span>.
            </a>
            <p class="text-gray-400 mt-6 pr-8 text-lg">
              Empowering businesses with simple, smart, and powerful POS
              solutions.
            </p>
          </div>

          <!-- Column 2: Links -->
          <div class="md:col-span-12 lg:col-span-7">
            <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
              <!-- Product Links -->
              <div>
                <h4
                  class="text-white font-bold text-lg mb-6 uppercase tracking-wider"
                >
                  Product
                </h4>
                <ul class="space-y-4">
                  <li>
                    <a
                      href="home#features"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Features</a
                    >
                  </li>
                  <li>
                    <a
                      href="home"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Pricing</a
                    >
                  </li>
                  <li>
                    <a
                      href="support"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Support</a
                    >
                  </li>
                  <li>
                    <a
                      href="workplace"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Start Free Trial</a
                    >
                  </li>
                </ul>
              </div>

              <!-- Company Links -->
              <div>
                <h4
                  class="text-white font-bold text-lg mb-6 uppercase tracking-wider"
                >
                  Company
                </h4>
                <ul class="space-y-4">
                  <li>
                    <a
                      href="#"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >About Us</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Blog</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Careers</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Contact</a
                    >
                  </li>
                </ul>
              </div>

              <!-- Legal Links -->
              <div>
                <h4
                  class="text-white font-bold text-lg mb-6 uppercase tracking-wider"
                >
                  Legal
                </h4>
                <ul class="space-y-4">
                  <li>
                    <a
                      href="#"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Privacy Policy</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Terms of Service</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      class="text-gray-400 hover:text-accent transition-colors duration-300"
                      >Cookie Policy</a
                    >
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Bar: Copyright & Socials -->
      <div class="bg-black py-8 border-t border-gray-800">
        <div
          class="container mx-auto px-6 flex flex-col md:flex-row justify-between items-center text-center md:text-left"
        >
          <p class="text-gray-500 mb-4 md:mb-0">
            &copy; 2025 CashShilpo. All rights reserved. A new era of business
            management.
          </p>

          <!-- Socials -->
          <div class="flex space-x-6">
            <a
              href="#"
              class="text-gray-400 hover:text-accent transform hover:scale-125 transition-all duration-300"
            >
              <i data-lucide="instagram" class="h-6 w-6"></i>
            </a>
            <a
              href="#"
              class="text-gray-400 hover:text-accent transform hover:scale-125 transition-all duration-300"
            >
              <i data-lucide="twitter" class="h-6 w-6"></i>
            </a>
            <a
              href="#"
              class="text-gray-400 hover:text-accent transform hover:scale-125 transition-all duration-300"
            >
              <i data-lucide="linkedin" class="h-6 w-6"></i>
            </a>
            <a
              href="#"
              class="text-gray-400 hover:text-accent transform hover:scale-125 transition-all duration-300"
            >
              <i data-lucide="facebook" class="h-6 w-6"></i>
            </a>
          </div>
        </div>
      </div>
    </footer>

    <script type="module">
      // Firebase imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        serverTimestamp,
        doc,
        // --- FIX: getDoc is no longer needed here ---
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyCBhzyl_1KpaROyjDaXX7fyLv-gQRoOTY0",
        authDomain: "cashshilpo.firebaseapp.com",
        projectId: "cashshilpo",
        storageBucket: "cashshilpo.firebasestorage.app",
        messagingSenderId: "544846655087",
        appId: "1:544846655087:web:0269ce6564c6b42c62a79a",
        measurementId: "G-GT06B6K2T6",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // --- Plan Definitions ---
      const YEARLY_DISCOUNT_PERCENT = 20;
      const plans = {
        basic_monthly: {
          id: "basic_monthly",
          name: "Basic (Monthly Plan)",
          price: 1499,
          currency: "৳",
          duration: "monthly",
          limits: { stores: 1, products: 1000, staff: 5, ai: "none" },
        },
        basic_yearly: {
          id: "basic_yearly",
          name: "Basic (Yearly Plan)",
          price: Math.round(1499 * 12 * (1 - YEARLY_DISCOUNT_PERCENT / 100)),
          currency: "৳",
          duration: "yearly",
          limits: { stores: 1, products: 1000, staff: 5, ai: "none" },
        },
        standard_monthly: {
          id: "standard_monthly",
          name: "Standard (Monthly Plan)",
          price: 2999,
          currency: "৳",
          duration: "monthly",
          limits: { stores: 3, products: 10000, staff: 20, ai: "basic" },
        },
        standard_yearly: {
          id: "standard_yearly",
          name: "Standard (Yearly Plan)",
          price: Math.round(2999 * 12 * (1 - YEARLY_DISCOUNT_PERCENT / 100)),
          currency: "৳",
          duration: "yearly",
          limits: { stores: 3, products: 10000, staff: 20, ai: "basic" },
        },
        premium_monthly: {
          id: "premium_monthly",
          name: "Premium (Monthly Plan)",
          price: 5999,
          currency: "৳",
          duration: "monthly",
          limits: { stores: 10, products: 50000, staff: 50, ai: "advanced" },
        },
        premium_yearly: {
          id: "premium_yearly",
          name: "Premium (Yearly Plan)",
          price: Math.round(5999 * 12 * (1 - YEARLY_DISCOUNT_PERCENT / 100)),
          currency: "৳",
          duration: "yearly",
          limits: { stores: 10, products: 50000, staff: 50, ai: "advanced" },
        },
      };

      // --- NEW: Plan Hierarchy ---
      const planHierarchy = {
        trial: 0,
        basic: 1,
        standard: 2,
        premium: 3,
      };

      // --- NEW: Simplified Subscription Status Check ---
      // This is copied from your main app's logic
      const checkSubscriptionStatus = (userData) => {
        if (!userData) return { isValid: false, status: "error" };
        const sub = userData.subscription || {};
        const trialEndsDate = sub.trialEndsAt ? sub.trialEndsAt.toDate() : null;
        let effectiveStatus = sub.status;
        if (
          effectiveStatus === "trial" &&
          trialEndsDate &&
          trialEndsDate < new Date()
        ) {
          effectiveStatus = "trial_expired";
        }
        if (effectiveStatus === "active" || effectiveStatus === "trial") {
          return { isValid: true, status: effectiveStatus, planId: sub.planId };
        }
        return { isValid: false, status: effectiveStatus, planId: sub.planId };
      };

      // --- Global State ---
      let selectedPlan = null;
      let currentUserSubscription = null;
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get("uid");
      const userEmail = urlParams.get("email");
      // --- FIX: Get status and planId from URL ---
      const subStatusFromUrl = urlParams.get("status");
      const planIdFromUrl = urlParams.get("planId");

      // --- Price Calculation Logic ---
      function calculateAndDisplayPrices() {
        const formatter = new Intl.NumberFormat("en-US");
        const toggleBadge = document.getElementById("toggle-save-badge");
        if (toggleBadge) {
          toggleBadge.innerHTML = `Save ${YEARLY_DISCOUNT_PERCENT}%`;
        }
        const pricingCards = document.querySelectorAll("[data-monthly-price]");
        pricingCards.forEach((card) => {
          const monthlyPrice = parseFloat(card.dataset.monthlyPrice);
          if (isNaN(monthlyPrice)) return;
          const originalYearlyPrice = monthlyPrice * 12;
          const discountedYearlyPrice = Math.round(
            originalYearlyPrice * (1 - YEARLY_DISCOUNT_PERCENT / 100)
          );

          card.querySelector(
            ".price-monthly-value"
          ).innerHTML = `৳${formatter.format(monthlyPrice)}`;
          card.querySelector(
            ".price-yearly-original"
          ).innerHTML = `৳${formatter.format(originalYearlyPrice)}`;
          card.querySelector(
            ".price-yearly-discounted"
          ).innerHTML = `৳${formatter.format(discountedYearlyPrice)}`;
          card.querySelector(
            ".price-yearly-save"
          ).innerHTML = `Save ${YEARLY_DISCOUNT_PERCENT}%`;

          const monthlyBtn = card.querySelector(
            '.btn-renew[data-plan-id$="_monthly"]'
          );
          const yearlyBtn = card.querySelector(
            '.btn-renew[data-plan-id$="_yearly"]'
          );
          if (monthlyBtn)
            monthlyBtn.innerHTML = `Renew Monthly (৳${formatter.format(
              monthlyPrice
            )})`;
          if (yearlyBtn)
            yearlyBtn.innerHTML = `Renew Yearly (৳${formatter.format(
              discountedYearlyPrice
            )})`;
        });
      }

      // --- Scroll Animation Logic ---
      function setupAnimations() {
        const animatedElements = document.querySelectorAll(
          ".animate-fade-in-up, .animate-scale-in, .animate-stagger-children"
        );
        const generalObserver = new IntersectionObserver(
          (entries, observer) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("is-visible");
                observer.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.1 }
        );
        animatedElements.forEach((item) => generalObserver.observe(item));
      }

      // --- Price Toggle Logic ---
      function setupPriceToggle() {
        const priceToggle = document.getElementById("price-toggle-checkbox");
        if (!priceToggle) return;
        const monthlyPrices = document.querySelectorAll(".price-monthly");
        const yearlyPrices = document.querySelectorAll(".price-yearly");
        const labelMonthly = document.getElementById("label-monthly");
        const labelYearly = document.getElementById("label-yearly");

        priceToggle.addEventListener("change", () => {
          if (priceToggle.checked) {
            monthlyPrices.forEach((price) => price.classList.add("hidden"));
            yearlyPrices.forEach((price) => price.classList.remove("hidden"));
            labelMonthly.classList.replace("active", "inactive");
            labelYearly.classList.replace("inactive", "active");
          } else {
            monthlyPrices.forEach((price) => price.classList.remove("hidden"));
            yearlyPrices.forEach((price) => price.classList.add("hidden"));
            labelMonthly.classList.replace("inactive", "active");
            labelYearly.classList.replace("active", "inactive");
          }
        });
      }

      // --- NEW: Function to update UI based on subscription ---
      function updateUIForSubscription(subStatus) {
        const loadingOverlay = document.getElementById("loading-overlay");
        const mainContainer = document.getElementById("main-container");

        // This is an active, paying customer. Show "Upgrade" logic.
        if (subStatus.isValid && subStatus.status === "active") {
          document.getElementById(
            "main-header"
          ).innerHTML = `MANAGE YOUR <span class="text-accent">SUBSCRIPTION.</span>`;
          document.getElementById(
            "main-subheader"
          ).textContent = `You are currently on the ${
            plans[subStatus.planId]?.name || "current plan"
          }. Choose to upgrade your plan or switch to yearly billing to save.`;

          // --- FIX: Handle null or 'none' planId ---
          const [currentUserPlanBase, currentUserBillingCycle] = (
            subStatus.planId || "none_none"
          ).split("_");
          const currentPlanLevel = planHierarchy[currentUserPlanBase] || 0;

          document.querySelectorAll(".plan-card").forEach((card) => {
            const planBase = card.dataset.planBase;
            if (!planBase) return; // Skip enterprise card

            const cardPlanLevel = planHierarchy[planBase];
            const cardBadge = card.querySelector(".plan-badge");
            const monthlyBtn = card.querySelector(
              '.btn-renew[data-plan-id$="_monthly"]'
            );
            const yearlyBtn = card.querySelector(
              '.btn-renew[data-plan-id$="_yearly"]'
            );

            // --- Apply logic to both monthly and yearly buttons for this card ---
            [monthlyBtn, yearlyBtn].forEach((btn) => {
              if (!btn) return;

              const btnPlanId = btn.dataset.planId;
              const [btnPlanBase, btnBillingCycle] = btnPlanId.split("_");

              // Case 1: Re-buying exact same plan
              if (btnPlanId === subStatus.planId) {
                btn.disabled = true;
                btn.textContent = "Your Current Plan";
                card.classList.add("plan-card-disabled");
                if (cardBadge) {
                  cardBadge.textContent = "Current Plan";
                  cardBadge.className = "plan-badge badge-current-plan"; // Uses green
                }
              }
              // Case 2: Downgrading (e.g., Standard to Basic)
              else if (cardPlanLevel < currentPlanLevel) {
                btn.disabled = true;
                btn.textContent = "Downgrade";
                card.classList.add("plan-card-disabled");
                if (
                  cardBadge &&
                  !cardBadge.classList.contains("badge-current-plan")
                ) {
                  cardBadge.textContent = "Downgrade";
                  cardBadge.className = "plan-badge badge-downgrade"; // Uses gray
                }
              }
              // Case 3: Upgrading (e.g., Basic to Standard, or Basic Monthly to Basic Yearly)
              else if (
                cardPlanLevel > currentPlanLevel ||
                (cardPlanLevel === currentPlanLevel &&
                  btnBillingCycle === "yearly" &&
                  currentUserBillingCycle === "monthly")
              ) {
                btn.disabled = false;
                btn.innerHTML = `Upgrade to ${
                  btnBillingCycle === "yearly" ? "Yearly" : "Monthly"
                } <i data-lucide="zap" class="w-4 h-4 ml-2"></i>`;
                card.classList.remove("plan-card-disabled");
                // Don't add an "Upgrade" badge, it's implied. Keep "Most Popular".
                if (cardBadge && card.id === "plan-card-standard") {
                  cardBadge.textContent = "Most Popular";
                  cardBadge.className = "plan-badge badge-most-popular";
                }
              }
              // Case 4: Side-grade/Downgrade (e.g., Standard Yearly to Standard Monthly)
              else if (
                cardPlanLevel === currentPlanLevel &&
                btnBillingCycle === "monthly" &&
                currentUserBillingCycle === "yearly"
              ) {
                btn.disabled = true;
                btn.textContent = "Switch to Monthly"; // (at end of cycle)
                if (
                  cardBadge &&
                  !cardBadge.classList.contains("badge-current-plan")
                ) {
                  cardBadge.textContent = "Downgrade";
                  cardBadge.className = "plan-badge badge-downgrade";
                }
              } else {
                btn.disabled = false;
                btn.innerHTML = `Select ${
                  btnBillingCycle === "yearly" ? "Yearly" : "Monthly"
                }`;
              }
            });
          });
        }
        // This is an expired or trial user. Show "Renew" logic.
        else {
          document.getElementById(
            "main-header"
          ).innerHTML = `RENEW YOUR <span class="text-accent">SUBSCRIPTION.</span>`;
          let subheaderText =
            "Choose the plan that's right for you. Your account will be reactivated upon payment verification.";
          if (subStatus.status === "trial") {
            subheaderText =
              "Your trial is active! Choose a plan to continue service after your trial ends.";
          } else if (subStatus.status === "trial_expired") {
            subheaderText =
              "Your free trial has expired. Please choose a plan to continue.";
          }
          document.getElementById("main-subheader").textContent = subheaderText;

          // All buttons are "Renew" and are active
          document.querySelectorAll(".btn-renew").forEach((btn) => {
            btn.disabled = false;
            // Text content is already set by calculateAndDisplayPrices(), e.g., "Renew Monthly (৳2,499)"
          });
          // Highlight "Most Popular"
          const standardBadge = document.getElementById("badge-standard");
          if (standardBadge) {
            standardBadge.textContent = "Most Popular";
            standardBadge.className = "plan-badge badge-most-popular";
          }
        }

        lucide.createIcons();

        // Hide loader, show content
        loadingOverlay.style.opacity = 0;
        setTimeout(() => {
          loadingOverlay.style.display = "none";
          mainContainer.classList.remove("hidden");
        }, 300);
      }

      // --- Main Execution on DOM Load ---
      document.addEventListener("DOMContentLoaded", async () => {
        lucide.createIcons();

        // Show loader immediately
        const loadingOverlay = document.getElementById("loading-overlay");
        const mainContainer = document.getElementById("main-container");
        const errorContainer = document.getElementById("error-container");

        loadingOverlay.style.display = "flex";
        mainContainer.classList.add("hidden");
        errorContainer.classList.add("hidden");

        // --- Mobile Menu Toggle ---
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");
        const menuIcon = mobileMenuButton.querySelector("i");
        if (mobileMenuButton) {
          mobileMenuButton.addEventListener("click", () => {
            mobileMenu.classList.toggle("hidden");
            menuIcon.setAttribute(
              "data-lucide",
              mobileMenu.classList.contains("hidden") ? "menu" : "x"
            );
            lucide.createIcons();
          });
        }

        // --- Setup new features ---
        calculateAndDisplayPrices();
        setupAnimations();
        setupPriceToggle();

        // --- FIX: Check for valid user and GET subscription from URL ---
        if (!userId || !userEmail) {
          document.getElementById("error-message").textContent =
            "User information not found. Please return to the app and try the renewal link again.";
          loadingOverlay.style.display = "none";
          errorContainer.classList.remove("hidden");
          return;
        }

        document.getElementById("user-id-display").textContent = userId;

        // --- NEW: Use URL parameters for subscription status ---
        let subStatus;
        if (
          subStatusFromUrl &&
          subStatusFromUrl !== "undefined" &&
          subStatusFromUrl !== "null" &&
          planIdFromUrl
        ) {
          const isValid =
            subStatusFromUrl === "active" || subStatusFromUrl === "trial";
          subStatus = {
            isValid: isValid,
            status: subStatusFromUrl,
            planId:
              planIdFromUrl === "none" || planIdFromUrl === "null"
                ? null
                : planIdFromUrl,
          };

          // --- Update UI based on URL subscription ---
          updateUIForSubscription(subStatus);
        } else {
          // Fallback if params are missing (legacy link?)
          console.warn(
            "Subscription status not found in URL. Defaulting to 'expired' view."
          );
          updateUIForSubscription({
            isValid: false,
            status: "expired",
            planId: null,
          });
        }
        // --- END FIX ---

        // --- Event listener for plan selection buttons ---
        document.querySelectorAll(".btn-renew").forEach((button) => {
          button.addEventListener("click", () => {
            const planId = button.dataset.planId;
            selectedPlan = plans[planId];
            if (!selectedPlan) {
              console.error("Selected plan not found:", planId);
              return;
            }
            document.getElementById("payment-amount").textContent = `${
              selectedPlan.currency
            }${new Intl.NumberFormat("en-US").format(selectedPlan.price)}`;
            document.getElementById("selected-plan-name").textContent =
              selectedPlan.name;
            document.getElementById("step-1").classList.add("hidden");
            document.getElementById("step-2").classList.remove("hidden");
            window.scrollTo(0, 0);
          });
        });

        // --- Step navigation ---
        document
          .getElementById("back-to-plans")
          .addEventListener("click", () => {
            document.getElementById("step-2").classList.add("hidden");
            document.getElementById("step-1").classList.remove("hidden");
            window.scrollTo(0, 0);
          });

        // --- Form Submission ---
        document
          .getElementById("payment-proof-form")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById("submit-proof-btn");
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<div class="loader mr-2"></div> Submitting...`;

            const formData = new FormData(e.target);
            try {
              await addDoc(collection(db, "subscription_requests"), {
                userId: userId,
                userEmail: userEmail,
                planId: selectedPlan.id,
                planName: selectedPlan.name,
                planPrice: selectedPlan.price,
                planDuration: selectedPlan.duration,
                planLimits: selectedPlan.limits,
                paymentMethod: formData.get("paymentMethod"),
                transactionId: formData.get("transactionId"),
                senderNumber: formData.get("senderNumber"),
                requestDate: serverTimestamp(),
                status: "pending",
              });

              document.getElementById("step-2").classList.add("hidden");
              document.getElementById("step-3").classList.remove("hidden");
              window.scrollTo(0, 0);
            } catch (error) {
              console.error("Error submitting request:", error);
              console.error("An error occurred. Please try again.");
              submitBtn.disabled = false;
              submitBtn.innerHTML =
                'Submit for Verification <i data-lucide="arrow-right" class="w-5 h-5 ml-2"></i>';
              lucide.createIcons();
            }
          });
      });
    </script>
  </body>
</html>
