<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Cashshilpo • Premium Field CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              display: ["Plus Jakarta Sans", "sans-serif"],
            },
            colors: {
              brand: {
                50: "#eff6ff",
                100: "#dbeafe",
                500: "#3b82f6",
                600: "#2563eb",
                700: "#1d4ed8",
                900: "#0f172a",
              },
            },
            boxShadow: {
              soft: "0 4px 20px -2px rgba(0, 0, 0, 0.05)",
              glow: "0 0 15px rgba(59, 130, 246, 0.5)",
              card:
                "0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04), 0 8px 24px -4px rgba(0,0,0,0.02)",
              float:
                "0 20px 40px -4px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0,0,0,0.03)",
            },
            screens: {
              xs: "475px",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@500;600;700;800&display=swap");

      body {
        background-color: #f8f9fc;
        color: #1e293b;
        -webkit-font-smoothing: antialiased;
        -webkit-tap-highlight-color: transparent;
      }

      .heading-font {
        font-family: "Plus Jakarta Sans", sans-serif;
      }
      .page {
        display: none;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }
      .page.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }

      /* Loading Spinner */
      .loader {
        border: 3px solid #f3f3f3;
        border-radius: 50%;
        border-top: 3px solid #3b82f6;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* Glassmorphism */
      .glass {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.5);
      }
      .sidebar-glass {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-right: 1px solid rgba(0, 0, 0, 0.03);
      }

      /* Interactions */
      .hover-lift {
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
          box-shadow 0.3s ease;
      }
      .hover-lift:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.08);
      }
      .nav-item {
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
      }
      .nav-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: #0f172a;
        transform: scaleY(0);
        transition: transform 0.2s ease;
        border-radius: 0 4px 4px 0;
      }
      .nav-item.active {
        background: #f1f5f9;
        color: #0f172a;
      }
      .nav-item.active::before {
        transform: scaleY(1);
      }

      /* Inputs */
      .premium-input {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        transition: all 0.2s ease;
        font-size: 16px; /* Prevent iOS zoom */
      }
      .premium-input:focus {
        background: #ffffff;
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        outline: none;
      }

      /* Mobile Adjustments */
      .pb-safe {
        padding-bottom: env(safe-area-inset-bottom);
      }

      /* Pagination Button */
      .pagination-btn {
        @apply w-8 h-8 flex items-center justify-center rounded-lg text-sm font-bold transition-colors;
      }
      .pagination-btn.active {
        @apply bg-slate-900 text-white shadow-md;
      }
      .pagination-btn:not(.active) {
        @apply text-slate-500 hover:bg-slate-100;
      }

      /* --- MODAL SYSTEM FIX --- */
      .modal-backdrop {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 150;
        background-color: rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(4px);
        align-items: flex-end; /* Mobile: Bottom aligned */
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      @media (min-width: 768px) {
        .modal-backdrop {
          align-items: center;
        } /* Desktop: Center aligned */
      }
      .modal-backdrop.open {
        display: flex;
        opacity: 1;
      }

      .modal-panel {
        background: white;
        width: 100%;
        max-width: 32rem; /* md:max-w-lg */
        border-radius: 2rem 2rem 0 0; /* Mobile rounded top */
        box-shadow: 0 -10px 40px -10px rgba(0, 0, 0, 0.1);
        transform: translateY(100%); /* Mobile: Slide from bottom */
        transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1),
          opacity 0.3s ease;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
      }
      @media (min-width: 768px) {
        .modal-panel {
          border-radius: 2rem; /* Desktop fully rounded */
          transform: scale(0.95); /* Desktop: Scale effect */
          opacity: 0;
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
      }
      .modal-backdrop.open .modal-panel {
        transform: translateY(0) scale(1); /* Reset transform for both */
        opacity: 1;
      }
    </style>
  </head>
  <body
    class="h-screen overflow-hidden text-sm relative selection:bg-brand-100 selection:text-brand-900"
  >
    <!-- LOGIN SCREEN -->
    <div
      id="auth-screen"
      class="fixed inset-0 z-[100] bg-[#F8F9FC] flex flex-col items-center justify-center p-6"
    >
      <div
        class="w-full max-w-md bg-white p-8 md:p-10 rounded-[2.5rem] shadow-float border border-slate-100 text-center relative overflow-hidden"
      >
        <div
          class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-brand-600 to-indigo-600"
        ></div>

        <div
          class="w-16 h-16 bg-brand-900 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-brand-900/20 mx-auto mb-6"
        >
          <svg
            class="w-8 h-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"
            />
          </svg>
        </div>

        <h1 class="text-3xl font-bold text-slate-900 heading-font mb-2">
          Welcome Back
        </h1>
        <p class="text-slate-500 mb-8">
          Sign in to access your private database.
        </p>

        <form id="login-form" class="space-y-4 text-left">
          <div>
            <label
              class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2 ml-1"
              >Email</label
            >
            <input
              type="email"
              id="login-email"
              class="premium-input w-full rounded-xl px-4 py-3.5 text-slate-900 font-medium placeholder:text-slate-400"
              placeholder="admin@cashshilpo.com"
              required
            />
          </div>
          <div>
            <label
              class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2 ml-1"
              >Password</label
            >
            <input
              type="password"
              id="login-password"
              class="premium-input w-full rounded-xl px-4 py-3.5 text-slate-900 font-medium placeholder:text-slate-400"
              placeholder="••••••••"
              required
            />
          </div>

          <div
            id="login-error"
            class="hidden text-rose-500 text-xs font-bold text-center bg-rose-50 py-2 rounded-lg"
          ></div>

          <button
            type="submit"
            id="login-btn"
            class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold shadow-lg shadow-slate-900/20 hover:bg-slate-800 hover:scale-[1.02] active:scale-[0.98] transition-all mt-4 flex justify-center items-center gap-2"
          >
            <span>Sign In</span>
          </button>
        </form>
        <p class="mt-6 text-xs text-slate-400">
          Restricted Access • Authorized Personnel Only
        </p>
      </div>
    </div>

    <!-- APP CONTENT (Hidden by default) -->
    <div id="app-content" class="hidden w-full h-full flex">
      <!-- Sidebar Backdrop (Mobile) -->
      <div
        id="sidebar-backdrop"
        onclick="window.router.toggleSidebar()"
        class="fixed inset-0 z-40 bg-slate-900/20 backdrop-blur-sm md:hidden hidden opacity-0 transition-opacity duration-300"
      ></div>

      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="sidebar-glass w-72 h-full flex flex-col fixed md:relative z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300 shadow-2xl md:shadow-none"
      >
        <!-- Brand -->
        <div class="p-8 pb-6 flex items-center gap-3">
          <div
            class="w-10 h-10 bg-brand-900 rounded-xl flex items-center justify-center text-white shadow-lg shadow-slate-300"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              />
            </svg>
          </div>
          <div>
            <h1
              class="heading-font font-bold text-xl text-brand-900 tracking-tight"
            >
              Cashshilpo
            </h1>
            <p
              class="text-[10px] uppercase font-bold text-slate-400 tracking-widest"
            >
              Premium CRM
            </p>
          </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 px-4 py-4 space-y-1 overflow-y-auto">
          <button
            onclick="window.router.showPage('dashboard', this)"
            class="nav-item active w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-slate-900 font-medium group"
          >
            <svg
              class="w-5 h-5 transition-colors"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
              />
            </svg>
            Dashboard
          </button>
          <button
            onclick="window.router.showPage('clients', this)"
            class="nav-item w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-slate-900 font-medium group"
          >
            <svg
              class="w-5 h-5 transition-colors"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
              />
            </svg>
            Clients
            <span
              id="nav-count"
              class="ml-auto bg-slate-100 text-slate-600 px-2 py-0.5 rounded-lg text-[10px] font-bold opacity-0 transition-opacity"
              >0</span
            >
          </button>
          <button
            onclick="window.router.showPage('reports', this)"
            class="nav-item w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-slate-900 font-medium group"
          >
            <svg
              class="w-5 h-5 transition-colors"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              />
            </svg>
            Reports
          </button>
          <button
            onclick="window.router.showPage('calendar', this)"
            class="nav-item w-full flex items-center gap-3 px-4 py-3.5 rounded-xl text-slate-500 hover:bg-slate-50 hover:text-slate-900 font-medium group"
          >
            <svg
              class="w-5 h-5 transition-colors"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2"
              />
            </svg>
            Schedule
          </button>
        </nav>

        <!-- User Profile Mini -->
        <div class="p-4 border-t border-slate-100">
          <div
            class="bg-white p-3 rounded-2xl shadow-card border border-slate-50 flex items-center gap-3 cursor-pointer hover:bg-slate-50 transition-colors"
            id="logout-btn"
          >
            <div
              class="w-9 h-9 rounded-full bg-gradient-to-tr from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-xs shadow-md shadow-blue-200"
            >
              AD
            </div>
            <div class="flex-1 min-w-0">
              <p
                class="text-sm font-bold text-slate-900 truncate"
                id="user-email-display"
              >
                Admin
              </p>
              <p
                class="text-[10px] text-slate-400 font-bold truncate text-red-500"
              >
                Tap to Logout
              </p>
            </div>
            <svg
              class="w-4 h-4 text-slate-300"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
              />
            </svg>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main
        class="flex-1 flex flex-col min-w-0 h-full relative overflow-hidden bg-[#F8F9FC]"
      >
        <!-- Header -->
        <header
          class="glass sticky top-0 z-30 px-4 md:px-6 py-3 md:py-4 flex items-center justify-between"
        >
          <div class="flex items-center gap-3 md:gap-4 w-full md:w-auto">
            <button
              onclick="window.router.toggleSidebar()"
              class="md:hidden p-2 text-slate-500 hover:bg-slate-100 rounded-lg active:bg-slate-200"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h7"
                />
              </svg>
            </button>
            <div
              class="flex-1 md:flex-none flex items-center bg-white rounded-full border border-slate-200 px-4 py-2 md:w-80 focus-within:ring-2 focus-within:ring-blue-100 focus-within:border-blue-300 transition-all shadow-sm"
            >
              <svg
                class="w-4 h-4 text-slate-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
              <input
                type="text"
                id="global-search"
                class="bg-transparent border-none outline-none text-sm ml-3 w-full placeholder:text-slate-400"
                placeholder="Search data & press Enter..."
              />
            </div>
          </div>

          <div class="hidden md:flex items-center gap-4">
            <button
              onclick="window.ui.showAddClientModal()"
              class="bg-brand-900 hover:bg-slate-800 text-white text-sm font-semibold px-5 py-2.5 rounded-full flex items-center gap-2 shadow-lg shadow-slate-900/20 hover:shadow-slate-900/30 transition-all hover:-translate-y-0.5"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4v16m8-8H4"
                />
              </svg>
              New Visit
            </button>
          </div>
        </header>

        <!-- Scrollable Area -->
        <!-- FIX: Increased padding bottom (pb-40) so content clears mobile nav comfortably -->
        <div
          class="flex-1 overflow-auto p-4 md:p-8 scroll-smooth pb-40 md:pb-8"
          id="main-scroll"
        >
          <div class="max-w-7xl mx-auto space-y-6 md:space-y-8">
            <!-- Dashboard -->
            <div id="dashboard" class="page active">
              <div
                class="flex flex-col md:flex-row md:items-end justify-between mb-6 md:mb-8 gap-2"
              >
                <div>
                  <h2
                    class="heading-font text-2xl md:text-3xl font-bold text-slate-900 tracking-tight"
                  >
                    Overview
                  </h2>
                  <p class="text-slate-500 font-medium mt-1">
                    Live field operations summary.
                  </p>
                </div>
              </div>

              <!-- Stats Grid -->
              <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-8">
                <!-- Total Visits -->
                <div
                  class="bg-white rounded-2xl md:rounded-3xl p-4 md:p-6 shadow-card hover-lift cursor-pointer relative overflow-hidden group"
                >
                  <div
                    class="absolute top-0 right-0 w-24 h-24 bg-blue-50 rounded-full -mr-12 -mt-12 group-hover:scale-110 transition-transform"
                  ></div>
                  <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-2 md:mb-4">
                      <div
                        class="p-1.5 md:p-2 bg-blue-50 text-blue-600 rounded-lg md:rounded-xl"
                      >
                        <svg
                          class="w-4 h-4 md:w-5 md:h-5"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                          />
                        </svg>
                      </div>
                    </div>
                    <div
                      class="text-2xl md:text-3xl font-bold text-slate-900 heading-font"
                      id="stat-total"
                    >
                      0
                    </div>
                    <div class="text-xs md:text-sm text-slate-500 font-medium">
                      Total Visits
                    </div>
                  </div>
                </div>

                <!-- Hot Leads -->
                <div
                  class="bg-white rounded-2xl md:rounded-3xl p-4 md:p-6 shadow-card hover-lift cursor-pointer relative overflow-hidden group"
                >
                  <div
                    class="absolute top-0 right-0 w-24 h-24 bg-emerald-50 rounded-full -mr-12 -mt-12 group-hover:scale-110 transition-transform"
                  ></div>
                  <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-2 md:mb-4">
                      <div
                        class="p-1.5 md:p-2 bg-emerald-50 text-emerald-600 rounded-lg md:rounded-xl"
                      >
                        <svg
                          class="w-4 h-4 md:w-5 md:h-5"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"
                          />
                        </svg>
                      </div>
                    </div>
                    <div
                      class="text-2xl md:text-3xl font-bold text-slate-900 heading-font"
                      id="stat-hot"
                    >
                      0
                    </div>
                    <div class="text-xs md:text-sm text-slate-500 font-medium">
                      Hot Leads
                    </div>
                  </div>
                </div>

                <!-- Customers -->
                <div
                  class="bg-white rounded-2xl md:rounded-3xl p-4 md:p-6 shadow-card hover-lift cursor-pointer relative overflow-hidden group"
                >
                  <div
                    class="absolute top-0 right-0 w-24 h-24 bg-indigo-50 rounded-full -mr-12 -mt-12 group-hover:scale-110 transition-transform"
                  ></div>
                  <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-2 md:mb-4">
                      <div
                        class="p-1.5 md:p-2 bg-indigo-50 text-indigo-600 rounded-lg md:rounded-xl"
                      >
                        <svg
                          class="w-4 h-4 md:w-5 md:h-5"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                      </div>
                    </div>
                    <div
                      class="text-2xl md:text-3xl font-bold text-slate-900 heading-font"
                      id="stat-customers"
                    >
                      0
                    </div>
                    <div class="text-xs md:text-sm text-slate-500 font-medium">
                      Customers
                    </div>
                  </div>
                </div>

                <!-- Follow ups -->
                <div
                  class="bg-white rounded-2xl md:rounded-3xl p-4 md:p-6 shadow-card hover-lift cursor-pointer relative overflow-hidden group"
                >
                  <div
                    class="absolute top-0 right-0 w-24 h-24 bg-amber-50 rounded-full -mr-12 -mt-12 group-hover:scale-110 transition-transform"
                  ></div>
                  <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-2 md:mb-4">
                      <div
                        class="p-1.5 md:p-2 bg-amber-50 text-amber-600 rounded-lg md:rounded-xl"
                      >
                        <svg
                          class="w-4 h-4 md:w-5 md:h-5"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          />
                        </svg>
                      </div>
                    </div>
                    <div
                      class="text-2xl md:text-3xl font-bold text-slate-900 heading-font"
                      id="stat-followups"
                    >
                      0
                    </div>
                    <div class="text-xs md:text-sm text-slate-500 font-medium">
                      Follow-ups
                    </div>
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Main Feed -->
                <div class="lg:col-span-2 space-y-6">
                  <div class="flex items-center justify-between">
                    <h3 class="font-bold text-lg text-slate-900 heading-font">
                      Recent Activity
                    </h3>
                    <button
                      onclick="window.router.showPage('clients')"
                      class="text-xs font-bold uppercase tracking-wide text-brand-600 hover:text-brand-700"
                    >
                      View All
                    </button>
                  </div>
                  <div
                    class="bg-white rounded-3xl shadow-card overflow-hidden border border-slate-100/50 min-h-[200px]"
                    id="dashboard-clients"
                  >
                    <div class="h-full flex items-center justify-center p-8">
                      <div class="loader"></div>
                    </div>
                  </div>
                </div>

                <!-- Side Widget -->
                <div class="lg:col-span-1 space-y-6">
                  <div
                    class="relative overflow-hidden bg-slate-900 rounded-3xl p-8 text-white shadow-2xl shadow-slate-300"
                  >
                    <div class="relative z-10">
                      <h3 class="text-2xl font-bold mb-2 heading-font">
                        Admin Panel
                      </h3>
                      <p class="text-slate-400 text-sm mb-6">
                        Manage data securely. All changes are synced to your
                        private database.
                      </p>
                    </div>
                    <div
                      class="absolute bottom-0 right-0 opacity-10 pointer-events-none transform translate-x-1/4 translate-y-1/4"
                    >
                      <svg
                        class="w-48 h-48"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
                        />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Clients Page -->
            <div id="clients" class="page">
              <div
                class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 mb-8"
              >
                <div class="w-full md:w-auto">
                  <h2
                    class="heading-font text-2xl md:text-3xl font-bold text-slate-900 tracking-tight"
                  >
                    Client Database
                  </h2>
                  <p class="text-slate-500 font-medium mt-1">
                    Real-time sync from Firestore.
                  </p>
                </div>
                <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                  <div class="relative flex-1 md:w-48 group">
                    <select
                      id="client-sort"
                      class="appearance-none block w-full pl-4 pr-10 py-2.5 border-none rounded-xl bg-white text-sm font-medium shadow-card focus:outline-none focus:ring-2 focus:ring-blue-100 cursor-pointer text-slate-600"
                    >
                      <option value="newest">Newest First</option>
                      <option value="oldest">Oldest First</option>
                      <option value="name">Name (A-Z)</option>
                    </select>
                    <div
                      class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-slate-400"
                    >
                      <svg
                        class="w-4 h-4"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 9l-7 7-7-7"
                        />
                      </svg>
                    </div>
                  </div>
                  <div class="relative flex-1 md:w-64 group">
                    <div
                      class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                    >
                      <svg
                        class="h-4 w-4 text-slate-400"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                        />
                      </svg>
                    </div>
                    <input
                      type="text"
                      id="client-search"
                      class="block w-full pl-10 pr-3 py-2.5 border-none rounded-xl bg-white text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-100 shadow-card transition-all"
                      placeholder="Search by name or phone..."
                    />
                  </div>
                </div>
              </div>

              <!-- Filters -->
              <div
                class="flex gap-2 mb-8 overflow-x-auto pb-2 scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0 sticky top-0 md:relative z-20 bg-[#F8F9FC] md:bg-transparent pt-2 md:pt-0"
              >
                <button
                  onclick="window.data.filterClients('all')"
                  class="filter-btn active bg-slate-900 text-white px-5 py-2 rounded-full text-sm font-bold shadow-lg shadow-slate-900/20 hover:scale-105 transition-all whitespace-nowrap"
                >
                  All
                </button>
                <button
                  onclick="window.data.filterClients('hot')"
                  class="filter-btn bg-white text-slate-600 hover:text-emerald-700 hover:bg-emerald-50 px-5 py-2 rounded-full text-sm font-bold shadow-card transition-all whitespace-nowrap"
                >
                  Hot Leads
                </button>
                <button
                  onclick="window.data.filterClients('customer')"
                  class="filter-btn bg-white text-slate-600 hover:text-blue-700 hover:bg-blue-50 px-5 py-2 rounded-full text-sm font-bold shadow-card transition-all whitespace-nowrap"
                >
                  Customers
                </button>
                <button
                  onclick="window.data.filterClients('warm')"
                  class="filter-btn bg-white text-slate-600 hover:text-amber-700 hover:bg-amber-50 px-5 py-2 rounded-full text-sm font-bold shadow-card transition-all whitespace-nowrap"
                >
                  Follow-up
                </button>
              </div>

              <div
                id="clients-list"
                class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"
              >
                <!-- Populated by JS -->
              </div>

              <!-- Pagination -->
              <div
                id="pagination-controls"
                class="flex justify-center items-center gap-2 mt-8 hidden"
              >
                <button
                  onclick="window.data.prevPage()"
                  class="p-2 rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 disabled:opacity-50"
                  id="prev-btn"
                >
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    />
                  </svg>
                </button>
                <div id="pagination-numbers" class="flex gap-1"></div>
                <button
                  onclick="window.data.nextPage()"
                  class="p-2 rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 disabled:opacity-50"
                  id="next-btn"
                >
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    />
                  </svg>
                </button>
              </div>

              <div id="loading-clients" class="py-12 flex justify-center">
                <div class="loader"></div>
              </div>

              <div id="empty-clients" class="hidden py-24 text-center">
                <div
                  class="w-24 h-24 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6"
                >
                  <svg
                    class="w-10 h-10 text-slate-300"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                    />
                  </svg>
                </div>
                <h3 class="text-xl font-bold text-slate-900 heading-font">
                  No shops found
                </h3>
                <p class="text-slate-500 mt-2">
                  Add your first visit to start tracking.
                </p>
              </div>
            </div>

            <!-- Inventory Removed per user request -->

            <!-- Reports Page (Updated) -->
            <div id="reports" class="page">
              <div class="mb-8 flex justify-between items-end">
                <div>
                  <h2
                    class="heading-font text-2xl md:text-3xl font-bold text-slate-900 tracking-tight"
                  >
                    Analytics Engine
                  </h2>
                  <p class="text-slate-500 font-medium mt-1">
                    Real-time performance metrics calculated from live data.
                  </p>
                </div>
                <button
                  onclick="window.data.refreshReports()"
                  class="bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 px-4 py-2 rounded-xl text-sm font-bold shadow-sm transition-all flex items-center gap-2"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                    />
                  </svg>
                  Refresh
                </button>
              </div>

              <!-- KPIs -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div
                  class="bg-white p-6 rounded-3xl shadow-card border border-slate-50 relative overflow-hidden"
                >
                  <div class="relative z-10">
                    <div
                      class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-1"
                    >
                      Conversion Rate
                    </div>
                    <div
                      class="text-4xl font-bold text-slate-900 heading-font flex items-end gap-2"
                    >
                      <span id="report-conversion">0%</span>
                      <span
                        class="text-sm font-bold text-emerald-500 mb-1.5 bg-emerald-50 px-2 py-0.5 rounded-lg"
                        >Live</span
                      >
                    </div>
                    <p class="text-xs text-slate-400 mt-2">
                      Leads converted to customers
                    </p>
                  </div>
                  <div class="absolute right-0 top-0 p-6 opacity-5">
                    <svg
                      class="w-24 h-24"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                </div>

                <div
                  class="bg-white p-6 rounded-3xl shadow-card border border-slate-50 relative overflow-hidden"
                >
                  <div class="relative z-10">
                    <div
                      class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-1"
                    >
                      Pipeline Value (Est)
                    </div>
                    <div
                      class="text-4xl font-bold text-slate-900 heading-font"
                      id="report-pipeline"
                    >
                      $0
                    </div>
                    <p class="text-xs text-slate-400 mt-2">
                      Potential based on hot/warm leads
                    </p>
                  </div>
                  <div class="absolute right-0 top-0 p-6 opacity-5">
                    <svg
                      class="w-24 h-24"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                      <path
                        fill-rule="evenodd"
                        d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                </div>

                <div
                  class="bg-white p-6 rounded-3xl shadow-card border border-slate-50 relative overflow-hidden"
                >
                  <div class="relative z-10">
                    <div
                      class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-1"
                    >
                      Avg. Daily Visits
                    </div>
                    <div
                      class="text-4xl font-bold text-slate-900 heading-font"
                      id="report-daily"
                    >
                      0.0
                    </div>
                    <p class="text-xs text-slate-400 mt-2">
                      Based on last 30 days activity
                    </p>
                  </div>
                  <div class="absolute right-0 top-0 p-6 opacity-5">
                    <svg
                      class="w-24 h-24"
                      fill="currentColor"
                      viewBox="0 0 20 20"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                </div>
              </div>

              <!-- Main Charts -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Lead Distribution Chart -->
                <div
                  class="bg-white p-6 rounded-3xl shadow-card border border-slate-100 flex flex-col"
                >
                  <h3
                    class="font-bold text-lg text-slate-900 mb-6 heading-font"
                  >
                    Lead Status Distribution
                  </h3>
                  <div
                    class="flex-1 flex items-center justify-center relative min-h-[250px]"
                    id="chart-distribution-container"
                  >
                    <!-- SVG Donut Chart injected here -->
                  </div>
                  <div
                    class="flex justify-center gap-4 mt-6 flex-wrap"
                    id="chart-legend"
                  >
                    <!-- Legend injected here -->
                  </div>
                </div>

                <!-- Activity Trend -->
                <div
                  class="bg-white p-6 rounded-3xl shadow-card border border-slate-100 flex flex-col"
                >
                  <h3
                    class="font-bold text-lg text-slate-900 mb-6 heading-font"
                  >
                    Activity Volume
                  </h3>
                  <div
                    class="flex-1 flex items-end justify-between gap-2 min-h-[250px] pt-10 pb-2 px-2 border-b border-slate-100"
                    id="chart-activity-container"
                  >
                    <!-- Bars injected here -->
                  </div>
                  <div
                    class="flex justify-between mt-2 text-xs font-bold text-slate-400 uppercase px-2"
                  >
                    <span>Oldest</span>
                    <span>Recent</span>
                  </div>
                </div>
              </div>

              <!-- Data Table -->
              <div
                class="bg-white rounded-3xl shadow-card overflow-hidden border border-slate-100"
              >
                <div
                  class="p-6 border-b border-slate-50 flex justify-between items-center"
                >
                  <h3 class="font-bold text-lg text-slate-900 heading-font">
                    Recent Audit Log
                  </h3>
                  <button
                    class="text-xs font-bold text-brand-600 uppercase tracking-wide"
                  >
                    Download CSV
                  </button>
                </div>
                <div class="overflow-x-auto">
                  <table class="w-full text-left border-collapse">
                    <thead>
                      <tr
                        class="bg-slate-50 text-xs font-bold text-slate-500 uppercase tracking-wide"
                      >
                        <th class="px-6 py-4">Shop</th>
                        <th class="px-6 py-4">Status</th>
                        <th class="px-6 py-4">Logged By</th>
                        <th class="px-6 py-4 text-right">Date</th>
                      </tr>
                    </thead>
                    <tbody
                      id="report-table-body"
                      class="text-sm text-slate-700 divide-y divide-slate-50"
                    >
                      <!-- Rows -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Calendar Page -->
            <div id="calendar" class="page">
              <div class="max-w-4xl mx-auto">
                <div
                  class="bg-white rounded-[2rem] shadow-float overflow-hidden border border-slate-100"
                >
                  <div
                    class="p-6 md:p-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/30"
                  >
                    <div>
                      <h2
                        class="text-xl md:text-2xl font-bold text-slate-900 heading-font"
                      >
                        Schedule
                      </h2>
                      <p class="text-slate-500 text-sm mt-1">
                        Upcoming visits and calls
                      </p>
                    </div>
                    <button
                      onclick="window.ui.showAddEventModal()"
                      class="text-sm font-bold text-brand-600 bg-brand-50 hover:bg-brand-100 px-4 py-2 md:px-5 md:py-2.5 rounded-xl transition-colors"
                    >
                      + Reminder
                    </button>
                  </div>
                  <div class="p-6 md:p-8 space-y-4" id="followup-list">
                    <div class="flex justify-center py-8">
                      <div class="loader"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mobile Bottom Nav -->
        <nav
          class="md:hidden glass fixed bottom-0 w-full pb-safe z-50 border-t border-slate-200"
        >
          <div class="flex items-center justify-around py-3">
            <button
              onclick="window.router.showPage('dashboard', this)"
              class="nav-item-mobile active p-2 flex flex-col items-center gap-1 text-slate-400 active:text-brand-600 transition-all"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
                />
              </svg>
            </button>
            <button
              onclick="window.router.showPage('clients', this)"
              class="nav-item-mobile p-2 flex flex-col items-center gap-1 text-slate-400 active:text-brand-600 transition-all"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                />
              </svg>
            </button>
            <button
              onclick="window.ui.showAddClientModal()"
              class="relative -top-8 p-4 bg-slate-900 rounded-2xl text-white shadow-xl shadow-slate-900/40 hover:scale-105 active:scale-95 transition-all border-4 border-[#F8F9FC]"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4v16m8-8H4"
                />
              </svg>
            </button>
            <button
              onclick="window.router.showPage('reports', this)"
              class="nav-item-mobile p-2 flex flex-col items-center gap-1 text-slate-400 active:text-brand-600 transition-all"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
            </button>
            <button
              onclick="window.router.showPage('calendar', this)"
              class="nav-item-mobile p-2 flex flex-col items-center gap-1 text-slate-400 active:text-brand-600 transition-all"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2"
                />
              </svg>
            </button>
          </div>
        </nav>
      </main>
    </div>

    <!-- FIXED MODALS STRUCTURE -->
    <!-- Add Client -->
    <div id="add-client-modal" class="modal-backdrop">
      <div
        class="absolute inset-0 transition-opacity"
        onclick="window.ui.hideAddClientModal()"
      ></div>
      <div class="modal-panel" id="client-modal-panel">
        <div
          class="px-6 md:px-8 py-5 md:py-6 border-b border-slate-50 flex justify-between items-center bg-white rounded-t-[2rem]"
        >
          <div>
            <h3
              class="text-xl font-bold text-slate-900 heading-font"
              id="modal-title"
            >
              New Entry
            </h3>
            <p class="text-xs text-slate-400 font-medium mt-0.5">
              Database Transaction
            </p>
          </div>
          <button
            onclick="window.ui.hideAddClientModal()"
            class="w-9 h-9 flex items-center justify-center rounded-full bg-slate-50 hover:bg-slate-100 text-slate-400 transition-colors"
          >
            ✕
          </button>
        </div>

        <div class="p-6 md:p-8 overflow-y-auto space-y-6 flex-1">
          <input type="hidden" id="input-doc-id" />
          <div class="space-y-4">
            <input
              id="input-shop-name"
              type="text"
              class="premium-input w-full rounded-xl px-4 py-3.5 text-slate-900 font-medium text-sm placeholder:text-slate-400"
              placeholder="Shop Name *"
            />
            <div class="grid grid-cols-2 gap-4">
              <input
                id="input-owner-name"
                type="text"
                class="premium-input w-full rounded-xl px-4 py-3.5 text-slate-900 font-medium text-sm placeholder:text-slate-400"
                placeholder="Owner Name"
              />
              <input
                id="input-phone"
                type="tel"
                class="premium-input w-full rounded-xl px-4 py-3.5 text-slate-900 font-medium text-sm placeholder:text-slate-400"
                placeholder="Mobile Number"
              />
            </div>
            <input
              id="input-location"
              type="text"
              class="premium-input w-full rounded-xl px-4 py-3.5 text-slate-900 font-medium text-sm placeholder:text-slate-400"
              placeholder="Location/Address"
            />
          </div>

          <div>
            <label
              class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-3 ml-1"
              >Lead Status</label
            >
            <div class="grid grid-cols-2 gap-3">
              <label class="cursor-pointer">
                <input
                  type="radio"
                  name="status"
                  value="hot"
                  class="peer sr-only"
                />
                <div
                  class="p-3 md:p-3.5 rounded-xl border border-slate-100 bg-slate-50 text-slate-500 peer-checked:bg-emerald-50 peer-checked:border-emerald-200 peer-checked:text-emerald-700 hover:bg-white hover:shadow-sm transition-all text-center font-bold text-xs md:text-sm flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2"
                >
                  <span class="w-2 h-2 rounded-full bg-emerald-500"></span> Hot
                </div>
              </label>
              <label class="cursor-pointer">
                <input
                  type="radio"
                  name="status"
                  value="warm"
                  class="peer sr-only"
                  checked
                />
                <div
                  class="p-3 md:p-3.5 rounded-xl border border-slate-100 bg-slate-50 text-slate-500 peer-checked:bg-amber-50 peer-checked:border-amber-200 peer-checked:text-amber-700 hover:bg-white hover:shadow-sm transition-all text-center font-bold text-xs md:text-sm flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2"
                >
                  <span class="w-2 h-2 rounded-full bg-amber-500"></span> Follow
                </div>
              </label>
              <label class="cursor-pointer">
                <input
                  type="radio"
                  name="status"
                  value="cold"
                  class="peer sr-only"
                />
                <div
                  class="p-3 md:p-3.5 rounded-xl border border-slate-100 bg-slate-50 text-slate-500 peer-checked:bg-slate-200 peer-checked:border-slate-300 peer-checked:text-slate-800 hover:bg-white hover:shadow-sm transition-all text-center font-bold text-xs md:text-sm flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2"
                >
                  <span class="w-2 h-2 rounded-full bg-slate-400"></span> Cold
                </div>
              </label>
              <label class="cursor-pointer">
                <input
                  type="radio"
                  name="status"
                  value="customer"
                  class="peer sr-only"
                />
                <div
                  class="p-3 md:p-3.5 rounded-xl border border-slate-100 bg-slate-50 text-slate-500 peer-checked:bg-blue-50 peer-checked:border-blue-200 peer-checked:text-blue-700 hover:bg-white hover:shadow-sm transition-all text-center font-bold text-xs md:text-sm flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2"
                >
                  <span class="w-2 h-2 rounded-full bg-blue-500"></span> Sold
                </div>
              </label>
            </div>
          </div>
        </div>

        <div
          class="p-6 border-t border-slate-50 bg-slate-50/50 flex gap-4 pb-8 md:pb-6 rounded-b-none md:rounded-b-[2rem]"
        >
          <button
            onclick="window.ui.hideAddClientModal()"
            class="flex-1 py-3.5 rounded-xl font-bold text-slate-600 hover:bg-slate-200 transition-colors"
          >
            Cancel
          </button>
          <button
            onclick="window.data.saveClient()"
            id="save-client-btn"
            class="flex-[2] py-3.5 bg-slate-900 text-white rounded-xl font-bold shadow-lg shadow-slate-900/20 hover:bg-slate-800 transition-all"
          >
            Save Client
          </button>
        </div>
      </div>
    </div>

    <!-- Add Event -->
    <div id="add-event-modal" class="modal-backdrop">
      <div
        class="absolute inset-0 transition-opacity"
        onclick="window.ui.hideAddEventModal()"
      ></div>
      <div class="modal-panel max-w-sm mx-auto" id="event-modal-panel">
        <div class="p-8">
          <h3 class="text-xl font-bold text-slate-900 mb-6 heading-font">
            Set Reminder
          </h3>
          <div class="space-y-4">
            <input
              type="text"
              id="event-title"
              class="w-full border-b-2 border-slate-100 py-3 text-lg font-medium focus:outline-none focus:border-brand-500 bg-transparent rounded-none"
              placeholder="Who to visit?"
            />
            <input
              type="date"
              id="event-date"
              class="w-full border-b-2 border-slate-100 py-3 text-slate-600 focus:outline-none focus:border-brand-500 bg-transparent rounded-none"
            />
            <input
              type="text"
              id="event-note"
              class="w-full border-b-2 border-slate-100 py-3 text-sm focus:outline-none focus:border-brand-500 bg-transparent rounded-none"
              placeholder="Short note..."
            />
          </div>
          <div class="mt-8 flex justify-end gap-4">
            <button
              onclick="window.ui.hideAddEventModal()"
              class="text-slate-400 font-bold text-sm"
            >
              Cancel
            </button>
            <button
              onclick="window.data.saveReminder()"
              class="bg-brand-600 text-white px-6 py-2.5 rounded-xl font-bold text-sm hover:bg-brand-700 shadow-glow transition-all"
            >
              Set Reminder
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal (NEW) -->
    <div id="delete-confirmation-modal" class="modal-backdrop">
      <div
        class="absolute inset-0 transition-opacity"
        onclick="window.ui.hideDeleteModal()"
      ></div>
      <div
        class="modal-panel max-w-xs mx-auto text-center"
        id="delete-modal-panel"
      >
        <div class="p-8">
          <div
            class="w-16 h-16 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-500"
          >
            <svg
              class="w-8 h-8"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
              />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-900 mb-2 heading-font">
            Delete Client?
          </h3>
          <p class="text-slate-500 text-sm mb-6">
            This action cannot be undone. All data associated with this client
            will be removed.
          </p>

          <div class="flex gap-3">
            <button
              onclick="window.ui.hideDeleteModal()"
              class="flex-1 py-3 rounded-xl font-bold text-slate-600 bg-slate-50 hover:bg-slate-100 transition-colors"
            >
              Cancel
            </button>
            <button
              onclick="window.data.confirmDelete()"
              class="flex-1 py-3 bg-rose-600 text-white rounded-xl font-bold shadow-lg shadow-rose-900/20 hover:bg-rose-700 transition-all"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODULE SCRIPT: FIREBASE & APP LOGIC -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
        signInAnonymously,
        signInWithCustomToken,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        onSnapshot,
        query,
        orderBy,
        Timestamp,
        doc,
        updateDoc,
        deleteDoc,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // --- FIREBASE CONFIG ---
      const firebaseConfig = {
        apiKey: "AIzaSyDkz4GDxpBnWSGW4QTSU_iY9GCHR7AlctI",
        authDomain: "cutomer-db.firebaseapp.com",
        projectId: "cutomer-db",
        storageBucket: "cutomer-db.firebasestorage.app",
        messagingSenderId: "1077673926188",
        appId: "1:1077673926188:web:dad885392caee9382a3b89",
        measurementId: "G-WYJ4473BVF",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Standardize collection paths
      const APP_ID =
        typeof __app_id !== "undefined" ? __app_id : "default-app-id";

      // SWITCHED TO ROOT PATHS TO MATCH YOUR SECURITY RULES
      // Your rules match /clients and /reminders, so we must query specifically that.
      const getClientsCollection = () => collection(db, "clients");
      const getRemindersCollection = () => collection(db, "reminders");

      // --- STATE MANAGEMENT ---
      const state = {
        user: null,
        clients: [],
        reminders: [],
        filter: "all",
        sort: "newest",
        pagination: {
          currentPage: 1,
          itemsPerPage: 9,
        },
        deletingId: null, // Track ID to delete
        unsubscribeClients: null,
        unsubscribeReminders: null,
      };

      // --- AUTHENTICATION ---
      const loginForm = document.getElementById("login-form");
      const loginBtn = document.getElementById("login-btn");
      const loginError = document.getElementById("login-error");
      const authScreen = document.getElementById("auth-screen");
      const appContent = document.getElementById("app-content");
      const logoutBtn = document.getElementById("logout-btn");

      const initAuth = async () => {
        if (
          typeof __initial_auth_token !== "undefined" &&
          __initial_auth_token
        ) {
          try {
            // Try to sign in with environment token, but catch error if it fails
            // (It might fail if token is for a different project ID)
            await signInWithCustomToken(auth, __initial_auth_token);
          } catch (e) {
            console.warn(
              "Custom token failed - likely project mismatch (expected behavior for custom keys)",
              e,
            );
          }
        }
      };
      initAuth();

      onAuthStateChanged(auth, (user) => {
        if (user) {
          state.user = user;
          // If anonymous, show something else, but for this app assume admin
          document.getElementById("user-email-display").textContent =
            user.email || "Admin User";
          authScreen.classList.add("hidden");
          appContent.classList.remove("hidden");
          initDataListeners();
        } else {
          state.user = null;
          authScreen.classList.remove("hidden");
          appContent.classList.add("hidden");
          stopDataListeners();
        }
      });

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;

        loginBtn.innerHTML =
          '<div class="loader w-5 h-5 border-white border-t-transparent"></div>';
        loginError.classList.add("hidden");

        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (error) {
          console.error(error);
          // Fallback for demo/canvas environment if real auth fails
          if (
            window.location.hostname.includes("googleusercontent") ||
            window.location.hostname === ""
          ) {
            await signInAnonymously(auth);
          } else {
            loginError.textContent = "Invalid email or password.";
            loginError.classList.remove("hidden");
            loginBtn.innerHTML = "<span>Sign In</span>";
          }
        }
      });

      // Make signOut globally available for HTML onclick
      window.signOut = signOut;
      window.auth = auth;
      logoutBtn.addEventListener("click", () => signOut(auth));

      // --- GLOBAL SEARCH LOGIC ---
      document
        .getElementById("global-search")
        .addEventListener("keyup", (e) => {
          if (e.key === "Enter") {
            const term = e.target.value;
            // Switch to Clients page
            window.router.showPage("clients");
            // Set value in client search box
            document.getElementById("client-search").value = term;
            // Trigger search
            renderClients();
          }
        });

      // --- FIRESTORE DATA ---
      function initDataListeners() {
        if (!state.user) return;

        const userId = state.user.uid;

        // Clients Listener - Root 'clients' collection
        const q = query(getClientsCollection());
        state.unsubscribeClients = onSnapshot(
          q,
          (snapshot) => {
            state.clients = snapshot.docs.map((doc) => ({
              id: doc.id,
              ...doc.data(),
            }));
            updateDashboard();
            renderClients();
            renderReports(); // Update reports live
            document.getElementById("loading-clients").classList.add("hidden");
            const count = state.clients.length;
            document.getElementById("nav-count").textContent = count;
            document.getElementById("nav-count").classList.remove("opacity-0");
          },
          (error) => {
            console.error("Clients Listener Error:", error);
            document.getElementById(
              "loading-clients",
            ).innerHTML = `<p class="text-rose-500">Error loading data. Check console.</p>`;
          },
        );

        // Reminders Listener - Root 'reminders' collection
        const r = query(getRemindersCollection());
        state.unsubscribeReminders = onSnapshot(
          r,
          (snapshot) => {
            state.reminders = snapshot.docs.map((doc) => ({
              id: doc.id,
              ...doc.data(),
            }));
            // Sort reminders client side since complex queries are restricted
            state.reminders.sort((a, b) => new Date(a.date) - new Date(b.date));
            renderReminders();
          },
          (error) => console.error("Reminders Error:", error),
        );
      }

      function stopDataListeners() {
        if (state.unsubscribeClients) state.unsubscribeClients();
        if (state.unsubscribeReminders) state.unsubscribeReminders();
        state.clients = [];
        state.reminders = [];
      }

      // --- UI RENDER FUNCTIONS ---
      function updateDashboard() {
        document.getElementById("stat-total").textContent =
          state.clients.length;
        document.getElementById("stat-hot").textContent = state.clients.filter(
          (c) => c.status === "hot",
        ).length;
        document.getElementById(
          "stat-customers",
        ).textContent = state.clients.filter(
          (c) => c.status === "customer",
        ).length;
        document.getElementById(
          "stat-followups",
        ).textContent = state.clients.filter((c) => c.status === "warm").length;

        const dashList = document.getElementById("dashboard-clients");
        dashList.innerHTML = "";

        // Sort by timestamp desc for dashboard
        const recent = [...state.clients].sort(
          (a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0),
        );

        if (recent.length === 0) {
          dashList.innerHTML =
            '<div class="text-center p-8 text-slate-400">No recent activity</div>';
          return;
        }

        recent.slice(0, 5).forEach((c) => {
          let statusColor = "bg-slate-400";
          if (c.status === "hot") statusColor = "bg-emerald-500";
          if (c.status === "customer") statusColor = "bg-blue-500";
          if (c.status === "warm") statusColor = "bg-amber-500";

          const div = document.createElement("div");
          div.className =
            "flex items-center gap-4 p-4 border-b border-slate-50 last:border-0 hover:bg-slate-50 transition-colors cursor-pointer group";
          div.onclick = () => {
            window.router.showPage("clients");
            // Simple timeout to allow page transition
            setTimeout(() => {
              document.getElementById("client-search").value = c.shopName;
              renderClients();
            }, 100);
          };
          div.innerHTML = `
                    <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500 text-xs">${c.shopName
                      .substring(0, 2)
                      .toUpperCase()}</div>
                    <div class="flex-1 min-w-0">
                        <div class="font-bold text-sm text-slate-900 truncate">${
                          c.shopName
                        }</div>
                        <div class="text-xs font-medium text-slate-400 truncate mt-0.5">${
                          c.location
                        }</div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full ${statusColor}"></span>
                        <svg class="w-5 h-5 text-slate-300 group-hover:text-blue-500 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </div>
                `;
          dashList.appendChild(div);
        });
      }

      function renderClients() {
        const container = document.getElementById("clients-list");
        container.innerHTML = "";

        const searchTerm = document
          .getElementById("client-search")
          .value.toLowerCase();

        // 1. Filter
        let processed = state.clients.filter((c) => {
          const matchesSearch =
            c.shopName.toLowerCase().includes(searchTerm) ||
            (c.phone && c.phone.includes(searchTerm));
          const matchesFilter =
            state.filter === "all" || c.status === state.filter;
          return matchesSearch && matchesFilter;
        });

        // 2. Sort
        if (state.sort === "newest") {
          processed.sort(
            (a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0),
          );
        } else if (state.sort === "oldest") {
          processed.sort(
            (a, b) => (a.timestamp?.seconds || 0) - (b.timestamp?.seconds || 0),
          );
        } else if (state.sort === "name") {
          processed.sort((a, b) => a.shopName.localeCompare(b.shopName));
        }

        // 3. Paginate
        const totalItems = processed.length;
        const totalPages = Math.ceil(
          totalItems / state.pagination.itemsPerPage,
        );

        // Reset page if out of bounds
        if (state.pagination.currentPage > totalPages)
          state.pagination.currentPage = 1;
        if (state.pagination.currentPage < 1) state.pagination.currentPage = 1;

        const startIdx =
          (state.pagination.currentPage - 1) * state.pagination.itemsPerPage;
        const paginated = processed.slice(
          startIdx,
          startIdx + state.pagination.itemsPerPage,
        );

        // UI Handling
        if (processed.length === 0 && state.clients.length > 0) {
          container.innerHTML =
            '<div class="col-span-full text-center py-10 text-slate-400">No results match your filter.</div>';
          document
            .getElementById("pagination-controls")
            .classList.add("hidden");
          return;
        }

        if (state.clients.length === 0) {
          document.getElementById("empty-clients").classList.remove("hidden");
          document
            .getElementById("pagination-controls")
            .classList.add("hidden");
        } else {
          document.getElementById("empty-clients").classList.add("hidden");
        }

        paginated.forEach((client) => {
          let badgeClass, badgeText, badgeColor;
          if (client.status === "hot") {
            badgeClass = "text-emerald-700 bg-emerald-50 border-emerald-100";
            badgeText = "Hot Lead";
            badgeColor = "bg-emerald-500";
          } else if (client.status === "warm") {
            badgeClass = "text-amber-700 bg-amber-50 border-amber-100";
            badgeText = "Follow-up";
            badgeColor = "bg-amber-500";
          } else if (client.status === "customer") {
            badgeClass = "text-blue-700 bg-blue-50 border-blue-100";
            badgeText = "Customer";
            badgeColor = "bg-blue-500";
          } else {
            badgeClass = "text-slate-600 bg-slate-50 border-slate-100";
            badgeText = "Cold";
            badgeColor = "bg-slate-400";
          }

          const card = document.createElement("div");
          card.className =
            "bg-white p-5 md:p-6 rounded-2xl md:rounded-[1.25rem] shadow-card hover-lift border border-transparent hover:border-slate-100 transition-all group flex flex-col justify-between h-full";
          card.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-start mb-4">
                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[11px] font-bold uppercase tracking-wide border ${badgeClass}">
                                <span class="w-1.5 h-1.5 rounded-full ${badgeColor}"></span>
                                ${badgeText}
                            </span>
                            <div class="relative">
                                <button onclick="window.data.startEdit('${
                                  client.id
                                }')" class="text-slate-300 hover:text-brand-600 transition-colors p-1">
                                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                </button>
                            </div>
                        </div>
                        <h3 class="font-bold text-lg text-slate-900 leading-tight mb-1 heading-font truncate">${
                          client.shopName
                        }</h3>
                        <p class="text-sm text-slate-500 font-medium mb-4 truncate">${
                          client.owner || "No Owner"
                        }</p>
                        
                        <div class="space-y-2">
                             <div class="flex items-start gap-2 text-xs font-medium text-slate-500">
                                <svg class="w-4 h-4 text-slate-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                <span class="line-clamp-2">${
                                  client.location || "No Location"
                                }</span>
                             </div>
                        </div>
                    </div>
                    
                    <div class="pt-4 mt-auto border-t border-slate-50 grid grid-cols-2 gap-3">
                        <a href="tel:${
                          client.phone
                        }" class="flex items-center justify-center gap-2 py-2.5 rounded-xl bg-slate-900 text-white text-sm font-bold hover:bg-slate-800 transition-colors shadow-lg shadow-slate-200">
                            Call
                        </a>
                         <button onclick="window.data.deleteClient('${
                           client.id
                         }')" class="flex items-center justify-center gap-2 py-2.5 rounded-xl bg-white border border-slate-200 text-rose-600 text-sm font-bold hover:bg-rose-50 hover:border-rose-100 transition-colors">
                            Delete
                        </button>
                    </div>
                `;
          container.appendChild(card);
        });

        // Update Pagination Controls
        const paginationEl = document.getElementById("pagination-controls");
        if (totalPages > 1) {
          paginationEl.classList.remove("hidden");
          document.getElementById("prev-btn").disabled =
            state.pagination.currentPage === 1;
          document.getElementById("next-btn").disabled =
            state.pagination.currentPage === totalPages;

          const numbersContainer = document.getElementById(
            "pagination-numbers",
          );
          numbersContainer.innerHTML = "";

          // Logic to show limited page numbers (e.g., 1, 2, ..., 5)
          // For simplicity in this demo: 1 to TotalPages if < 5, else window around current
          let pagesToShow = [];
          if (totalPages <= 5) {
            pagesToShow = Array.from({ length: totalPages }, (_, i) => i + 1);
          } else {
            if (state.pagination.currentPage <= 3)
              pagesToShow = [1, 2, 3, 4, "...", totalPages];
            else if (state.pagination.currentPage >= totalPages - 2)
              pagesToShow = [
                1,
                "...",
                totalPages - 3,
                totalPages - 2,
                totalPages - 1,
                totalPages,
              ];
            else
              pagesToShow = [
                1,
                "...",
                state.pagination.currentPage - 1,
                state.pagination.currentPage,
                state.pagination.currentPage + 1,
                "...",
                totalPages,
              ];
          }

          pagesToShow.forEach((p) => {
            const btn = document.createElement("button");
            btn.className = `pagination-btn ${
              p === state.pagination.currentPage ? "active" : ""
            }`;
            btn.textContent = p;
            if (p !== "...") {
              btn.onclick = () => {
                state.pagination.currentPage = p;
                renderClients();
              };
            }
            numbersContainer.appendChild(btn);
          });
        } else {
          paginationEl.classList.add("hidden");
        }
      }

      function renderReminders() {
        const list = document.getElementById("followup-list");
        list.innerHTML = "";

        if (state.reminders.length === 0) {
          list.innerHTML =
            '<div class="text-center py-8 text-slate-400 text-sm">No upcoming reminders</div>';
          return;
        }

        state.reminders.forEach((ev) => {
          const dateObj = new Date(ev.date);
          const month = dateObj.toLocaleString("default", { month: "short" });
          const day = dateObj.getDate();

          const item = document.createElement("div");
          item.className =
            "flex items-center gap-5 p-5 rounded-2xl bg-white border border-slate-100 hover:border-slate-200 shadow-sm hover:shadow-md transition-all group";
          item.innerHTML = `
                    <div class="bg-brand-50 px-5 py-3 rounded-2xl text-center min-w-[80px] group-hover:bg-brand-100 transition-colors">
                        <div class="text-[10px] text-brand-600 font-bold uppercase tracking-widest">${month.toUpperCase()}</div>
                        <div class="text-2xl font-bold text-brand-900 heading-font">${day}</div>
                    </div>
                    <div class="flex-1">
                        <div class="font-bold text-slate-900 text-lg heading-font">${
                          ev.title
                        }</div>
                        <div class="text-sm font-medium text-slate-500 mt-1">${
                          ev.note
                        }</div>
                    </div>
                `;
          list.appendChild(item);
        });
      }

      // --- NEW REPORT ENGINE ---
      function renderReports() {
        // 1. Calculate KPIs
        const total = state.clients.length;
        if (total === 0) return; // Prevent division by zero

        const customers = state.clients.filter((c) => c.status === "customer")
          .length;
        const hot = state.clients.filter((c) => c.status === "hot").length;
        const warm = state.clients.filter((c) => c.status === "warm").length;
        const cold = state.clients.filter((c) => c.status === "cold").length;

        const conversionRate = Math.round((customers / total) * 100);

        // Dummy Pipeline Logic: Hot=$10k, Warm=$2k
        const pipelineValue = hot * 10000 + warm * 2000;

        // Average Daily Visits (Mock Calculation based on timestamps if available, otherwise just use total / 30)
        const avgDaily = (total / 30).toFixed(1);

        document.getElementById(
          "report-conversion",
        ).textContent = `${conversionRate}%`;
        document.getElementById("report-pipeline").textContent = `$${(
          pipelineValue / 1000
        ).toFixed(1)}k`;
        document.getElementById("report-daily").textContent = avgDaily;

        // 2. Render Donut Chart (SVG)
        renderDonutChart(hot, warm, cold, customers);

        // 3. Render Bar Chart (Activity)
        renderActivityChart(state.clients);

        // 4. Render Table
        renderReportTable(state.clients);
      }

      function renderDonutChart(hot, warm, cold, customer) {
        const container = document.getElementById(
          "chart-distribution-container",
        );
        const legend = document.getElementById("chart-legend");
        const total = hot + warm + cold + customer;

        if (total === 0) {
          container.innerHTML =
            '<div class="text-slate-400 font-medium">No data yet</div>';
          return;
        }

        // Colors
        const colors = {
          hot: "#10b981",
          warm: "#f59e0b",
          cold: "#94a3b8",
          customer: "#3b82f6",
        };
        const data = [
          { value: hot, color: colors.hot, label: "Hot" },
          { value: warm, color: colors.warm, label: "Warm" },
          { value: customer, color: colors.customer, label: "Sold" },
          { value: cold, color: colors.cold, label: "Cold" },
        ].filter((d) => d.value > 0);

        // SVG Logic
        let cumPercent = 0;
        let svgContent = "";

        data.forEach((slice) => {
          const [startX, startY] = getCoordinatesForPercent(cumPercent);
          cumPercent += slice.value / total;
          const [endX, endY] = getCoordinatesForPercent(cumPercent);
          const largeArcFlag = slice.value / total > 0.5 ? 1 : 0;

          const pathData = [
            `M ${startX} ${startY}`, // Move
            `A 1 1 0 ${largeArcFlag} 1 ${endX} ${endY}`, // Arc
            `L 0 0`, // Line to center
          ].join(" ");

          svgContent += `<path d="${pathData}" fill="${slice.color}" stroke="white" stroke-width="0.05"></path>`;
        });

        container.innerHTML = `
                <svg viewBox="-1.1 -1.1 2.2 2.2" style="transform: rotate(-90deg); width: 200px; height: 200px;">
                    ${svgContent}
                    <circle cx="0" cy="0" r="0.6" fill="white"></circle>
                </svg>
            `;

        // Legend
        legend.innerHTML = data
          .map(
            (d) => `
                <div class="flex items-center gap-2 text-xs font-bold text-slate-600">
                    <span class="w-3 h-3 rounded-full" style="background-color: ${
                      d.color
                    }"></span>
                    ${d.label} (${Math.round((d.value / total) * 100)}%)
                </div>
            `,
          )
          .join("");
      }

      function getCoordinatesForPercent(percent) {
        const x = Math.cos(2 * Math.PI * percent);
        const y = Math.sin(2 * Math.PI * percent);
        return [x, y];
      }

      function renderActivityChart(clients) {
        const container = document.getElementById("chart-activity-container");
        container.innerHTML = "";

        if (clients.length === 0) {
          container.innerHTML =
            '<div class="w-full text-center text-slate-400">No activity</div>';
          return;
        }

        // Group by arbitrary chunks for visual effect (In real app, group by date)
        // Simulating last 7 chunks of data
        const bars = 10;
        const dataPoints = Array(bars).fill(0);

        clients.forEach((c, i) => {
          const index = i % bars;
          dataPoints[index]++;
        });

        const max = Math.max(...dataPoints, 1);

        dataPoints.forEach((val) => {
          const height = (val / max) * 100;
          const bar = document.createElement("div");
          bar.className =
            "flex-1 bg-brand-100 hover:bg-brand-500 rounded-t-lg transition-all relative group";
          bar.style.height = `${Math.max(height, 5)}%`; // Min height 5%

          // Tooltip
          bar.innerHTML = `<div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-slate-900 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap font-bold">${val} Visits</div>`;

          container.appendChild(bar);
        });
      }

      function renderReportTable(clients) {
        const tbody = document.getElementById("report-table-body");
        tbody.innerHTML = "";

        // Show last 5
        const recent = [...clients]
          .sort(
            (a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0),
          )
          .slice(0, 5);

        recent.forEach((c) => {
          let badgeClass;
          if (c.status === "hot") badgeClass = "text-emerald-600 bg-emerald-50";
          else if (c.status === "customer")
            badgeClass = "text-blue-600 bg-blue-50";
          else if (c.status === "warm")
            badgeClass = "text-amber-600 bg-amber-50";
          else badgeClass = "text-slate-500 bg-slate-100";

          const tr = document.createElement("tr");
          tr.className = "hover:bg-slate-50 transition-colors";
          tr.innerHTML = `
                    <td class="px-6 py-4 font-bold text-slate-900">${c.shopName}</td>
                    <td class="px-6 py-4"><span class="${badgeClass} px-2 py-1 rounded text-xs font-bold uppercase tracking-wide">${c.status}</span></td>
                    <td class="px-6 py-4 text-slate-500">Admin</td>
                    <td class="px-6 py-4 text-right font-medium text-slate-400">Today</td>
                `;
          tbody.appendChild(tr);
        });
      }

      // --- PUBLIC ACTIONS (Bound to Window) ---
      window.data = {
        saveClient: async () => {
          if (!state.user) return;
          const btn = document.getElementById("save-client-btn");
          const originalText = btn.innerHTML;

          const docId = document.getElementById("input-doc-id").value;
          const shopName = document.getElementById("input-shop-name").value;
          const owner = document.getElementById("input-owner-name").value;
          const phone = document.getElementById("input-phone").value;
          const location = document.getElementById("input-location").value;
          const status = document.querySelector('input[name="status"]:checked')
            .value;

          if (!shopName) {
            alert("Shop Name is required");
            return;
          }

          btn.disabled = true;
          btn.innerHTML = "Saving...";

          try {
            const dataPayload = {
              shopName,
              owner,
              phone,
              location,
              status,
              timestamp: Timestamp.now(),
            };

            const userId = state.user.uid;
            const coll = getClientsCollection(); // No userId param needed for root collection

            if (docId) {
              // Update
              await updateDoc(doc(coll, docId), dataPayload);
            } else {
              // Create
              await addDoc(coll, dataPayload);
            }

            window.ui.hideAddClientModal();
            // Clear inputs
            window.data.resetForm();
          } catch (e) {
            console.error("Error saving: ", e);
            alert("Error saving client. See console.");
          } finally {
            btn.disabled = false;
            btn.innerHTML = originalText;
          }
        },
        resetForm: () => {
          document.getElementById("input-doc-id").value = "";
          document.getElementById("input-shop-name").value = "";
          document.getElementById("input-owner-name").value = "";
          document.getElementById("input-phone").value = "";
          document.getElementById("input-location").value = "";
          document.querySelector(
            'input[name="status"][value="warm"]',
          ).checked = true;
          document.getElementById("modal-title").textContent = "New Entry";
          document.getElementById("save-client-btn").textContent =
            "Save Client";
        },
        startEdit: (id) => {
          const client = state.clients.find((c) => c.id === id);
          if (!client) return;

          document.getElementById("input-doc-id").value = client.id;
          document.getElementById("input-shop-name").value = client.shopName;
          document.getElementById("input-owner-name").value = client.owner;
          document.getElementById("input-phone").value = client.phone;
          document.getElementById("input-location").value = client.location;
          // Radio buttons
          const radio = document.querySelector(
            `input[name="status"][value="${client.status}"]`,
          );
          if (radio) radio.checked = true;

          document.getElementById("modal-title").textContent = "Edit Client";
          document.getElementById("save-client-btn").textContent =
            "Update Client";
          window.ui.showAddClientModal();
        },
        deleteClient: (id) => {
          if (!state.user) return;
          state.deletingId = id;
          window.ui.showDeleteModal();
        },
        confirmDelete: async () => {
          if (!state.deletingId) return;
          try {
            const userId = state.user.uid;
            await deleteDoc(doc(getClientsCollection(), state.deletingId));
            window.ui.hideDeleteModal();
            state.deletingId = null;
          } catch (e) {
            console.error("Error deleting", e);
            alert("Could not delete");
          }
        },
        saveReminder: async () => {
          if (!state.user) return;
          const title = document.getElementById("event-title").value;
          const date = document.getElementById("event-date").value;
          const note = document.getElementById("event-note").value;

          if (!title || !date) return;

          const userId = state.user.uid;
          await addDoc(getRemindersCollection(), {
            title,
            date,
            note,
            timestamp: Timestamp.now(),
          });
          window.ui.hideAddEventModal();
        },
        filterClients: (type) => {
          state.filter = type;
          state.pagination.currentPage = 1; // Reset to page 1
          document
            .querySelectorAll(".filter-btn")
            .forEach((b) =>
              b.classList.remove("active", "bg-slate-900", "text-white"),
            );
          document.querySelectorAll(".filter-btn").forEach((b) => {
            if (!b.classList.contains("active"))
              b.classList.add("bg-white", "text-slate-600");
          });

          // Highlight active button (This logic could be cleaner, but works for vanilla JS demo)
          const activeBtn = Array.from(
            document.querySelectorAll(".filter-btn"),
          ).find((b) => b.getAttribute("onclick").includes(`'${type}'`));
          if (activeBtn) {
            activeBtn.classList.remove("bg-white", "text-slate-600");
            activeBtn.classList.add("bg-slate-900", "text-white", "active");
          }

          renderClients();
        },
        nextPage: () => {
          state.pagination.currentPage++;
          renderClients();
        },
        prevPage: () => {
          state.pagination.currentPage--;
          renderClients();
        },
        refreshReports: () => {
          // Simulate refresh
          renderReports();
        },
      };

      window.ui = {
        showAddClientModal: () => {
          const el = document.getElementById("add-client-modal");
          el.classList.add("open");
        },
        hideAddClientModal: () => {
          const el = document.getElementById("add-client-modal");
          el.classList.remove("open");
          setTimeout(() => window.data.resetForm(), 300);
        },
        showAddEventModal: () => {
          const el = document.getElementById("add-event-modal");
          el.classList.add("open");
        },
        hideAddEventModal: () => {
          const el = document.getElementById("add-event-modal");
          el.classList.remove("open");
        },
        showDeleteModal: () => {
          const el = document.getElementById("delete-confirmation-modal");
          el.classList.add("open");
        },
        hideDeleteModal: () => {
          const el = document.getElementById("delete-confirmation-modal");
          el.classList.remove("open");
        },
      };

      window.router = {
        showPage: (pageId, btnElement) => {
          document
            .querySelectorAll(".page")
            .forEach((p) => p.classList.remove("active"));
          document.getElementById(pageId).classList.add("active");

          // Desktop Nav
          document
            .querySelectorAll(".nav-item")
            .forEach((b) => b.classList.remove("active"));
          if (btnElement && btnElement.classList.contains("nav-item"))
            btnElement.classList.add("active");

          // Mobile Nav
          document
            .querySelectorAll(".nav-item-mobile")
            .forEach((b) => b.classList.remove("text-brand-600", "active"));
          if (btnElement && btnElement.classList.contains("nav-item-mobile"))
            btnElement.classList.add("text-brand-600");

          // Close sidebar on mobile if navigating
          const sidebar = document.getElementById("sidebar");
          if (
            !sidebar.classList.contains("-translate-x-full") &&
            window.innerWidth < 768
          ) {
            window.router.toggleSidebar();
          }

          // Scroll to top
          document.getElementById("main-scroll").scrollTop = 0;
        },
        toggleSidebar: () => {
          const sidebar = document.getElementById("sidebar");
          const backdrop = document.getElementById("sidebar-backdrop");
          const isClosed = sidebar.classList.contains("-translate-x-full");

          if (isClosed) {
            sidebar.classList.remove("-translate-x-full");
            backdrop.classList.remove("hidden");
            setTimeout(() => backdrop.classList.remove("opacity-0"), 10);
          } else {
            sidebar.classList.add("-translate-x-full");
            backdrop.classList.add("opacity-0");
            setTimeout(() => backdrop.classList.add("hidden"), 300);
          }
        },
      };

      // Listeners
      document.getElementById("client-search").addEventListener("input", () => {
        state.pagination.currentPage = 1;
        renderClients();
      });
      document.getElementById("client-sort").addEventListener("change", (e) => {
        state.sort = e.target.value;
        renderClients();
      });
    </script>
  </body>
</html>
